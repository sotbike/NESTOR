############################################## PACKAGES & LIBRARIES ################################################

# Package installation and library loading
install.packages("meta")
install.packages("metafor")
install.packages("metasens")

library(meta)
library(metafor)
library(metasens)

################################################### DATASETS #######################################################

# First we import the required datasets for primary variables
MAJOR_COMP<-read.csv("C:/Users/sotbi/Desktop/Data/MAJOR_COMP.csv", sep=";", header=TRUE)
MINOR_COMP<-read.csv("C:/Users/sotbi/Desktop/Data/MINOR_COMP.csv", sep=";", header=TRUE)
PSM<-read.csv("C:/Users/sotbi/Desktop/Data/PSM.csv", sep=";", header=TRUE)
IT<-read.csv("C:/Users/sotbi/Desktop/Data/IT.csv", sep=";", header=TRUE)
ΔEGFR<-read.csv("C:/Users/sotbi/Desktop/Data/ΔEGFR.csv", sep=";", header=TRUE)
ΔCREATININE<-read.csv("C:/Users/sotbi/Desktop/Data/ΔCREATININE.csv", sep=";", header=TRUE)


# We create a new folder named "Plots_S" on desktop 
folder_name <- "Plots_S"
# Specify the desktop path
desktop_path <- file.path("C:/Users/sotbi/Desktop")
# Create the folder path
folder_path <- file.path(desktop_path, folder_name)

# Check if the folder already exists
if (dir.exists(folder_path)) {
  print("Folder already exists!")
} else {
  # Create the folder on the desktop
  dir.create(folder_path)
  print("Folder created successfully!")
}

# And now we set the working directory to the new folder 
# This is where the plots are to be saved
setwd("C:/Users/sotbi/Desktop/Plots_S")


#################################################### PLOTS ##########################################################

# First we define the width & height parameters for the different plots
# The same parameters for MRA plots are defined in the same way below
# Pooled analysis forest plot parameters
W_for_pool <- 900
H_for_pool <- 1200
# Funnel & Radial plot parameters
W_fr <- 1200 
H_fr <- 780
# Subgroup analysis forest plot parameters
W_for_sga <- 900
H_for_sga <- 1300


# We have similar patterns of MRA plots, so we can adjust their width & height parameters from here
# Pooled
W_pool <- 1200
H_pool <- 780
# Matching
W_match <- 1000
H_match <- 1250
# Center
W_center <- 1000
H_center <- 1250
# Robins
W_robins <- 1000 
H_robins <- 1500


#################################################### MAJOR_COMP (REM) ##########################################################

#Now we define the dataset of interest
dset<-MAJOR_COMP

# First we define the order of reporting the different subgroups
order_post2018 <- c("Studies published after 2018", "Studies published before 2018")
order_matching <- c("Studies with patient matching", "Studies without patient matching")
order_center <- c("Multicenter studies", "Single-center studies")
order_robins <- c("Studies with ROBINS-I: Low", "Studies with ROBINS-I: Moderate", "Studies with ROBINS-I: Serious")

# Then we apply the predefined order of reporting to the dataset
dset$post2018 <- factor(dset$post2018, levels = order_post2018)
dset$matching <- factor(dset$matching, levels = order_matching)
dset$center <- factor(dset$center, levels = order_center)
dset$robins <- factor(dset$robins, levels = order_robins)


# Pooled meta analysis
png("1. Forest plot (pooled).png", width = 800, height = 700)
mc0re<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE)
forestmc0re<-forest(mc0re, text.addline1 = "Odds Ratio in major complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
weights_mc <- mc0re$w.random
dev.off()

png("2. Funnel plot.png", width = W_fr, height = H_fr)
# We set the margins to add space
# mar = c(bottom, left, top, right)
# mgp1: distance between the axis title and labels, mgp2: distance between the axis ticks and labels
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0))  
funnelmc0re<-funnel(mc0re, pch = 20,cex = 1, contour = c(0.9,0.95,0.99), col.contour = c("darkgray", "gray", "lightgray"), xlim = c(0.01,70), xlab = "", ylab = "", axes = TRUE)
legend(0.01,0.01, c("0.1 > p > 0.05", "0.05 > p > 0.01", "p < 0.01"), fill = c("darkgray", "gray", "lightgray"), bty = "n", cex = 1.5)
title("Funnel plot with contours of statistical significance", cex.main = 2, xlab = "log Odds Ratio (logOR)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()

png("3. Radial plot with Egger's test.png", width = W_fr, height = H_fr)
radialmc0re<-radial(mc0re)
eggersmc0re<-metabias(mc0re, method.bias = "linreg", plotit = TRUE)
eggersmc0re
regmc0re<-lm(I(mc0re$TE/mc0re$seTE) ~ I(1/mc0re$seTE))
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
radial(mc0re, cex = 1.5, cex.lab = 1.5, axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
abline(regmc0re)
title("Radial plot with a solid regression line for Egger's test", cex.main = 2)
dev.off()

# Small study Effects
png("4. Funnel plot with small study effects.png", width = W_fr, height = H_fr)
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
l2<-limitmeta(mc0re)
funnel(l2, cex = 1.5, xlim = c(0.01,30), xlab = "", ylab = "", axes = TRUE)
print(l2, digits = 3)
title("Funnel plot with a curved regression line for small study effects", cex.main = 2, xlab = "log Odds Ratio (logOR)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()


# subgroup analysis (post2018)
png("5. Forest plot with subgroups according to publication year.png", width = 800, height = 850)
mc0repost2018<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = post2018, print.byvar = FALSE)
forestmc0repost2018<-forest(mc0repost2018, text.addline1 = "Odds Ratio in major complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (matching)
png("6. Forest plot with subgroups according to patient matching.png", width = 800, height = 850)
mc0rematched<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = matching, print.byvar = FALSE)
forestmc0rematched<-forest(mc0rematched, text.addline1 = "Odds Ratio in major complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (center)
png("7. Forest plot with subgroups according to the number of centers.png", width = 800, height = 850)
mc0recenter<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = center, print.byvar = FALSE)
forestmc0recenter<-forest(mc0recenter, text.addline1 = "Odds Ratio in major complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (robins)
png("8. Forest plot with subgroups according to ROBINS-I.png", width = 800, height = 850)
mc0rerobins<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = robins, print.byvar = FALSE)
forestmc0rerobins<-forest(mc0rerobins, text.addline1 = "Odds Ratio in major complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()


# Meta Regression Analysis for publication year in all studies (using metafor)
png("9. MRA plot according to publication year (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
mc0remtf<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset, append = TRUE)
mc0remtfma<-rma(yi, vi, data = mc0remtf, method = "REML", mods = ~year)
yearvec<-seq(min(dset$year), max(dset$year), 1)
preds2<-predict(mc0remtfma, newmods = yearvec)
wi2<-1/sqrt(mc0remtf$vi+mc0remtfma$tau2)
size2<-1+2*(wi2 - min(wi2)) / (max(wi2) - min(wi2))
plot(mc0remtf$year, mc0remtf$yi, pch = 1, cex = size2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvec, preds2$pred, lwd = 2, col = "red")
lines(yearvec, preds2$ci.lb, lty = "dashed")
lines(yearvec, preds2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("10. MRA plot according to publication year in studies with or without patient matching.png", width = W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in studies with patient matching (using metafor)
mc0remtfmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmamatched<-rma(yi, vi, data = mc0remtfmatched, method = "REML", mods = ~year)
yearvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$year), max(dset[dset$matching=="Studies with patient matching",]$year), 1)
predsmatched2<-predict(mc0remtfmamatched, newmods = yearvecmatched)
wimatched2<-1/sqrt(mc0remtfmatched$vi+mc0remtfmamatched$tau2)
sizematched2<- 1+2*(wimatched2 - min(wimatched2)) / (max(wimatched2) - min(wimatched2))
plot(mc0remtfmatched$year, mc0remtfmatched$yi, pch = 1, cex = sizematched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmatched, predsmatched2$pred, lwd = 2, col = "darkgreen")
lines(yearvecmatched, predsmatched2$ci.lb, lty = "dashed")
lines(yearvecmatched, predsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in studies without patient matching (using metafor)
mc0remtfnonmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmanonmatched<-rma(yi, vi, data = mc0remtfnonmatched, method = "REML", mods = ~year)
yearvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$year), max(dset[dset$matching=="Studies without patient matching",]$year), 1)
predsnonmatched2<-predict(mc0remtfmanonmatched, newmods = yearvecnonmatched)
winonmatched2<-1/sqrt(mc0remtfnonmatched$vi+mc0remtfmanonmatched$tau2)
sizenonmatched2<- 1+2*(winonmatched2 - min(winonmatched2)) / (max(winonmatched2) - min(winonmatched2))
plot(mc0remtfnonmatched$year, mc0remtfnonmatched$yi, pch = 1, cex = sizenonmatched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecnonmatched, predsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(yearvecnonmatched, predsnonmatched2$ci.lb, lty = "dashed")
lines(yearvecnonmatched, predsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("11. MRA plot according to publication year in multi- or single-center studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in multicenter studies (using metafor)
mc0remtfmulti<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmamulti<-rma(yi, vi, data = mc0remtfmulti, method = "REML", mods = ~year)
yearvecmulti<-seq(min(data = dset[dset$center=="Multicenter studies",]$year), max(data = dset[dset$center=="Multicenter studies",]$year), 1)
predsmulti2<-predict(mc0remtfmamulti, newmods = yearvecmulti)
wimulti2<-1/sqrt(mc0remtfmulti$vi+mc0remtfmamulti$tau2)
sizemulti2<- 1+2*(wimulti2 - min(wimulti2)) / (max(wimulti2) - min(wimulti2))
plot(mc0remtfmulti$year, mc0remtfmulti$yi, pch = 1, cex = sizemulti2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmulti, predsmulti2$pred, lwd = 2, col = "darkblue")
lines(yearvecmulti, predsmulti2$ci.lb, lty = "dashed")
lines(yearvecmulti, predsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in single-center studies (using metafor)
mc0remtfsingle<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmasingle<-rma(yi, vi, data = mc0remtfsingle, method = "REML", mods = ~year)
yearvecsingle<-seq(min(data = dset[dset$center=="Single-center studies",]$year), max(data = dset[dset$center=="Single-center studies",]$year), 1)
predssingle2<-predict(mc0remtfmasingle, newmods = yearvecsingle)
wisingle2<-1/sqrt(mc0remtfsingle$vi+mc0remtfmasingle$tau2)
sizesingle2<- 1+2*(wisingle2 - min(wisingle2)) / (max(wisingle2) - min(wisingle2))
plot(mc0remtfsingle$year, mc0remtfsingle$yi, pch = 1, cex = sizesingle2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecsingle, predssingle2$pred, lwd = 2, col = "lightblue")
lines(yearvecsingle, predssingle2$ci.lb, lty = "dashed")
lines(yearvecsingle, predssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("12. MRA plot according to publication year in studies with low - moderate - serious risk of bias.png", width = W_robins, height = H_robins)
par(mfrow = c(3, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in ROBINS-I: "Low Risk of Bias" studies (using metafor)
mc0remtflow<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Low",], append = TRUE)
mc0remtfmalow<-rma(yi, vi, data = mc0remtflow, method = "REML", mods = ~year)
yearveclow<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), 1)
predslow2<-predict(mc0remtfmalow, newmods = yearveclow)
wilow2<-1/sqrt(mc0remtflow$vi+mc0remtfmalow$tau2)
sizelow2<- 1+2*(wilow2 - min(wilow2)) / (max(wilow2) - min(wilow2))
plot(mc0remtflow$year, mc0remtflow$yi, pch = 1, cex = sizelow2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Low", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearveclow, predslow2$pred, lwd = 2, col = "purple")
lines(yearveclow, predslow2$ci.lb, lty = "dashed")
lines(yearveclow, predslow2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Moderate Risk of Bias" studies (using metafor)
mc0remtfmoderate<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Moderate",], append = TRUE)
mc0remtfmamoderate<-rma(yi, vi, data = mc0remtfmoderate, method = "REML", mods = ~year)
yearvecmoderate<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), 1)
predsmoderate2<-predict(mc0remtfmamoderate, newmods = yearvecmoderate)
wimoderate2<-1/sqrt(mc0remtfmoderate$vi+mc0remtfmamoderate$tau2)
sizemoderate2<- 1+2*(wimoderate2 - min(wimoderate2)) / (max(wimoderate2) - min(wimoderate2))
plot(mc0remtfmoderate$year, mc0remtfmoderate$yi, pch = 1, cex = sizemoderate2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Moderate", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecmoderate, predsmoderate2$pred, lwd = 2, col = "magenta")
lines(yearvecmoderate, predsmoderate2$ci.lb, lty = "dashed")
lines(yearvecmoderate, predsmoderate2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Serious Risk of Bias" studies (using metafor)
mc0remtfserious<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Serious",], append = TRUE)
mc0remtfmaserious<-rma(yi, vi, data = mc0remtfserious, method = "REML", mods = ~year)
yearvecserious<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), 1)
predsserious2<-predict(mc0remtfmaserious, newmods = yearvecserious)
wiserious2<-1/sqrt(mc0remtfserious$vi+mc0remtfmaserious$tau2)
sizeserious2<- 1+2*(wiserious2 - min(wiserious2)) / (max(wiserious2) - min(wiserious2))
plot(mc0remtfserious$year, mc0remtfserious$yi, pch = 1, cex = sizeserious2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Serious", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecserious, predsserious2$pred, lwd = 2, col = "pink")
lines(yearvecserious, predsserious2$ci.lb, lty = "dashed")
lines(yearvecserious, predsserious2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
dev.off()



png("13. MRA plot according to NOS quality stars (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in all studies (using metafor)
mc0remtfstars<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset, append = TRUE)
mc0remtfmastars<-rma(yi, vi, data = mc0remtfstars, method = "REML", mods = ~stars)
starsvec<-seq(min(dset$stars), max(dset$stars), 1)
predsstars2<-predict(mc0remtfmastars, newmods = starsvec)
wistars2<-1/sqrt(mc0remtfstars$vi+mc0remtfmastars$tau2)
sizestars2<-1+2*(wistars2 - min(wistars2)) / (max(wistars2) - min(wistars2))
plot(mc0remtfstars$stars, mc0remtfstars$yi, pch = 1, cex = sizestars2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvec, predsstars2$pred, lwd = 2, col = "red")
lines(starsvec, predsstars2$ci.lb, lty = "dashed")
lines(starsvec, predsstars2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("14. MRA plot according to NOS quality stars in studies with or without patient matching.png", W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies with patient matching (using metafor)
mc0remtfstarsmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmastarsmatched<-rma(yi, vi, data = mc0remtfstarsmatched, method = "REML", mods = ~stars)
starsvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$stars), max(dset[dset$matching=="Studies with patient matching",]$stars), 1)
predsstarsmatched2<-predict(mc0remtfmastarsmatched, newmods = starsvecmatched)
wistarsmatched2<-1/sqrt(mc0remtfstarsmatched$vi+mc0remtfmastarsmatched$tau2)
sizestarsmatched2<-1+2*(wistarsmatched2 - min(wistarsmatched2)) / (max(wistarsmatched2) - min(wistarsmatched2))
plot(mc0remtfstarsmatched$stars, mc0remtfstarsmatched$yi, pch = 1, cex = sizestarsmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmatched, predsstarsmatched2$pred, lwd = 2, col = "darkgreen")
lines(starsvecmatched, predsstarsmatched2$ci.lb, lty = "dashed")
lines(starsvecmatched, predsstarsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies without patient matching (using metafor)
mc0remtfstarsnonmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmastarsnonmatched<-rma(yi, vi, data = mc0remtfstarsnonmatched, method = "REML", mods = ~stars)
starsvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$stars), max(dset[dset$matching=="Studies without patient matching",]$stars), 1)
predsstarsnonmatched2<-predict(mc0remtfmastarsnonmatched, newmods = starsvecnonmatched)
wistarsnonmatched2<-1/sqrt(mc0remtfstarsnonmatched$vi+mc0remtfmastarsnonmatched$tau2)
sizestarsnonmatched2<-1+2*(wistarsnonmatched2 - min(wistarsnonmatched2)) / (max(wistarsnonmatched2) - min(wistarsnonmatched2))
plot(mc0remtfstarsnonmatched$stars, mc0remtfstarsnonmatched$yi, pch = 1, cex = sizestarsnonmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecnonmatched, predsstarsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.lb, lty = "dashed")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("15. MRA plot according to NOS quality stars in single- or multicenter studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in multicenter studies (using metafor)
mc0remtfstarsmulti<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmastarsmulti<-rma(yi, vi, data = mc0remtfstarsmulti, method = "REML", mods = ~stars)
starsvecmulti<-seq(min(dset[dset$center=="Multicenter studies",]$stars), max(dset[dset$center=="Multicenter studies",]$stars), 1)
predsstarsmulti2<-predict(mc0remtfmastarsmulti, newmods = starsvecmulti)
wistarsmulti2<-1/sqrt(mc0remtfstarsmulti$vi+mc0remtfmastarsmulti$tau2)
sizestarsmulti2<-1+2*(wistarsmulti2 - min(wistarsmulti2)) / (max(wistarsmulti2) - min(wistarsmulti2))
plot(mc0remtfstarsmulti$stars, mc0remtfstarsmulti$yi, pch = 1, cex = sizestarsmulti2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmulti, predsstarsmulti2$pred, lwd = 2, col = "darkblue")
lines(starsvecmulti, predsstarsmulti2$ci.lb, lty = "dashed")
lines(starsvecmulti, predsstarsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in single-center studies (using metafor)
mc0remtfstarssingle<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmastarssingle<-rma(yi, vi, data = mc0remtfstarssingle, method = "REML", mods = ~stars)
starsvecsingle<-seq(min(dset[dset$center=="Single-center studies",]$stars), max(dset[dset$center=="Single-center studies",]$stars), 1)
predsstarssingle2<-predict(mc0remtfmastarssingle, newmods = starsvecsingle)
wistarssingle2<-1/sqrt(mc0remtfstarssingle$vi+mc0remtfmastarssingle$tau2)
sizestarssingle2<-1+2*(wistarssingle2 - min(wistarssingle2)) / (max(wistarssingle2) - min(wistarssingle2))
plot(mc0remtfstarssingle$stars, mc0remtfstarssingle$yi, pch = 1, cex = sizestarssingle2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in major complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecsingle, predsstarssingle2$pred, lwd = 2, col = "lightblue")
lines(starsvecsingle, predsstarssingle2$ci.lb, lty = "dashed")
lines(starsvecsingle, predsstarssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


#################################################### MINOR_COMP (REM) ##########################################################

#Now we define the dataset of interest
dset<-MINOR_COMP

# First we define the order of reporting the different subgroups
order_post2018 <- c("Studies published after 2018", "Studies published before 2018")
order_matching <- c("Studies with patient matching", "Studies without patient matching")
order_center <- c("Multicenter studies", "Single-center studies")
order_robins <- c("Studies with ROBINS-I: Low", "Studies with ROBINS-I: Moderate", "Studies with ROBINS-I: Serious")

# Then we apply the predefined order of reporting to the dataset
dset$post2018 <- factor(dset$post2018, levels = order_post2018)
dset$matching <- factor(dset$matching, levels = order_matching)
dset$center <- factor(dset$center, levels = order_center)
dset$robins <- factor(dset$robins, levels = order_robins)


# Pooled meta analysis
png("16. Forest plot (pooled).png", width = 800, height = 550)
mc0re<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE)
forestmc0re<-forest(mc0re, text.addline1 = "Odds Ratio in minor complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
weights_mc <- mc0re$w.random
dev.off()

png("17. Funnel plot.png", width = W_fr, height = H_fr)
# We set the margins to add space
# mar = c(bottom, left, top, right)
# mgp1: distance between the axis title and labels, mgp2: distance between the axis ticks and labels
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0))  
funnelmc0re<-funnel(mc0re, pch = 20,cex = 1, contour = c(0.9,0.95,0.99), col.contour = c("darkgray", "gray", "lightgray"), xlim = c(0.01,90), xlab = "", ylab = "", axes = TRUE)
legend(0.01,0.01, c("0.1 > p > 0.05", "0.05 > p > 0.01", "p < 0.01"), fill = c("darkgray", "gray", "lightgray"), bty = "n", cex = 1.5)
title("Funnel plot with contours of statistical significance", cex.main = 2, xlab = "log Odds Ratio (logOR)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()

png("18. Radial plot with Egger's test.png", width = W_fr, height = H_fr)
radialmc0re<-radial(mc0re)
eggersmc0re<-metabias(mc0re, method.bias = "linreg", plotit = TRUE)
eggersmc0re
regmc0re<-lm(I(mc0re$TE/mc0re$seTE) ~ I(1/mc0re$seTE))
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
radial(mc0re, cex = 1.5, cex.lab = 1.5, axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
abline(regmc0re)
title("Radial plot with a solid regression line for Egger's test", cex.main = 2)
dev.off()

# Small study Effects
png("19. Funnel plot with small study effects.png", width = W_fr, height = H_fr)
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
l2<-limitmeta(mc0re)
funnel(l2, cex = 1.5, xlim = c(0.01,30), xlab = "", ylab = "", axes = TRUE)
print(l2, digits = 3)
title("Funnel plot with a curved regression line for small study effects", cex.main = 2, xlab = "log Odds Ratio (logOR)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()


# subgroup analysis (post2018)
png("20. Forest plot with subgroups according to publication year.png", width = 800, height = 700)
mc0repost2018<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = post2018, print.byvar = FALSE)
forestmc0repost2018<-forest(mc0repost2018, text.addline1 = "Odds Ratio in minor complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (matching)
png("21. Forest plot with subgroups according to patient matching.png", width = 800, height = 700)
mc0rematched<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = matching, print.byvar = FALSE)
forestmc0rematched<-forest(mc0rematched, text.addline1 = "Odds Ratio in minor complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (center)
png("22. Forest plot with subgroups according to the number of centers.png", width = 800, height = 700)
mc0recenter<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = center, print.byvar = FALSE)
forestmc0recenter<-forest(mc0recenter, text.addline1 = "Odds Ratio in minor complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (robins)
png("23. Forest plot with subgroups according to ROBINS-I.png", width = 800, height = 700)
mc0rerobins<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = robins, print.byvar = FALSE)
forestmc0rerobins<-forest(mc0rerobins, text.addline1 = "Odds Ratio in minor complication rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()


# Meta Regression Analysis for publication year in all studies (using metafor)
png("24. MRA plot according to publication year (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
mc0remtf<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset, append = TRUE)
mc0remtfma<-rma(yi, vi, data = mc0remtf, method = "REML", mods = ~year)
yearvec<-seq(min(dset$year), max(dset$year), 1)
preds2<-predict(mc0remtfma, newmods = yearvec)
wi2<-1/sqrt(mc0remtf$vi+mc0remtfma$tau2)
size2<-1+2*(wi2 - min(wi2)) / (max(wi2) - min(wi2))
plot(mc0remtf$year, mc0remtf$yi, pch = 1, cex = size2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvec, preds2$pred, lwd = 2, col = "red")
lines(yearvec, preds2$ci.lb, lty = "dashed")
lines(yearvec, preds2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("25. MRA plot according to publication year in studies with or without patient matching.png", width = W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in studies with patient matching (using metafor)
mc0remtfmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmamatched<-rma(yi, vi, data = mc0remtfmatched, method = "REML", mods = ~year)
yearvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$year), max(dset[dset$matching=="Studies with patient matching",]$year), 1)
predsmatched2<-predict(mc0remtfmamatched, newmods = yearvecmatched)
wimatched2<-1/sqrt(mc0remtfmatched$vi+mc0remtfmamatched$tau2)
sizematched2<- 1+2*(wimatched2 - min(wimatched2)) / (max(wimatched2) - min(wimatched2))
plot(mc0remtfmatched$year, mc0remtfmatched$yi, pch = 1, cex = sizematched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmatched, predsmatched2$pred, lwd = 2, col = "darkgreen")
lines(yearvecmatched, predsmatched2$ci.lb, lty = "dashed")
lines(yearvecmatched, predsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in studies without patient matching (using metafor)
mc0remtfnonmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmanonmatched<-rma(yi, vi, data = mc0remtfnonmatched, method = "REML", mods = ~year)
yearvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$year), max(dset[dset$matching=="Studies without patient matching",]$year), 1)
predsnonmatched2<-predict(mc0remtfmanonmatched, newmods = yearvecnonmatched)
winonmatched2<-1/sqrt(mc0remtfnonmatched$vi+mc0remtfmanonmatched$tau2)
sizenonmatched2<- 1+2*(winonmatched2 - min(winonmatched2)) / (max(winonmatched2) - min(winonmatched2))
plot(mc0remtfnonmatched$year, mc0remtfnonmatched$yi, pch = 1, cex = sizenonmatched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecnonmatched, predsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(yearvecnonmatched, predsnonmatched2$ci.lb, lty = "dashed")
lines(yearvecnonmatched, predsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("26. MRA plot according to publication year in multi- or single-center studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in multicenter studies (using metafor)
mc0remtfmulti<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmamulti<-rma(yi, vi, data = mc0remtfmulti, method = "REML", mods = ~year)
yearvecmulti<-seq(min(data = dset[dset$center=="Multicenter studies",]$year), max(data = dset[dset$center=="Multicenter studies",]$year), 1)
predsmulti2<-predict(mc0remtfmamulti, newmods = yearvecmulti)
wimulti2<-1/sqrt(mc0remtfmulti$vi+mc0remtfmamulti$tau2)
sizemulti2<- 1+2*(wimulti2 - min(wimulti2)) / (max(wimulti2) - min(wimulti2))
plot(mc0remtfmulti$year, mc0remtfmulti$yi, pch = 1, cex = sizemulti2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmulti, predsmulti2$pred, lwd = 2, col = "darkblue")
lines(yearvecmulti, predsmulti2$ci.lb, lty = "dashed")
lines(yearvecmulti, predsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in single-center studies (using metafor)
mc0remtfsingle<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmasingle<-rma(yi, vi, data = mc0remtfsingle, method = "REML", mods = ~year)
yearvecsingle<-seq(min(data = dset[dset$center=="Single-center studies",]$year), max(data = dset[dset$center=="Single-center studies",]$year), 1)
predssingle2<-predict(mc0remtfmasingle, newmods = yearvecsingle)
wisingle2<-1/sqrt(mc0remtfsingle$vi+mc0remtfmasingle$tau2)
sizesingle2<- 1+2*(wisingle2 - min(wisingle2)) / (max(wisingle2) - min(wisingle2))
plot(mc0remtfsingle$year, mc0remtfsingle$yi, pch = 1, cex = sizesingle2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecsingle, predssingle2$pred, lwd = 2, col = "lightblue")
lines(yearvecsingle, predssingle2$ci.lb, lty = "dashed")
lines(yearvecsingle, predssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("27. MRA plot according to publication year in studies with low - moderate - serious risk of bias.png", width = W_robins, height = H_robins)
par(mfrow = c(3, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in ROBINS-I: "Low Risk of Bias" studies (using metafor)
mc0remtflow<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Low",], append = TRUE)
mc0remtfmalow<-rma(yi, vi, data = mc0remtflow, method = "REML", mods = ~year)
yearveclow<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), 1)
predslow2<-predict(mc0remtfmalow, newmods = yearveclow)
wilow2<-1/sqrt(mc0remtflow$vi+mc0remtfmalow$tau2)
sizelow2<- 1+2*(wilow2 - min(wilow2)) / (max(wilow2) - min(wilow2))
plot(mc0remtflow$year, mc0remtflow$yi, pch = 1, cex = sizelow2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Low", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearveclow, predslow2$pred, lwd = 2, col = "purple")
lines(yearveclow, predslow2$ci.lb, lty = "dashed")
lines(yearveclow, predslow2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Moderate Risk of Bias" studies (using metafor)
mc0remtfmoderate<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Moderate",], append = TRUE)
mc0remtfmamoderate<-rma(yi, vi, data = mc0remtfmoderate, method = "REML", mods = ~year)
yearvecmoderate<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), 1)
predsmoderate2<-predict(mc0remtfmamoderate, newmods = yearvecmoderate)
wimoderate2<-1/sqrt(mc0remtfmoderate$vi+mc0remtfmamoderate$tau2)
sizemoderate2<- 1+2*(wimoderate2 - min(wimoderate2)) / (max(wimoderate2) - min(wimoderate2))
plot(mc0remtfmoderate$year, mc0remtfmoderate$yi, pch = 1, cex = sizemoderate2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Moderate", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecmoderate, predsmoderate2$pred, lwd = 2, col = "magenta")
lines(yearvecmoderate, predsmoderate2$ci.lb, lty = "dashed")
lines(yearvecmoderate, predsmoderate2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Serious Risk of Bias" studies (using metafor)
mc0remtfserious<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Serious",], append = TRUE)
mc0remtfmaserious<-rma(yi, vi, data = mc0remtfserious, method = "REML", mods = ~year)
yearvecserious<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), 1)
predsserious2<-predict(mc0remtfmaserious, newmods = yearvecserious)
wiserious2<-1/sqrt(mc0remtfserious$vi+mc0remtfmaserious$tau2)
sizeserious2<- 1+2*(wiserious2 - min(wiserious2)) / (max(wiserious2) - min(wiserious2))
plot(mc0remtfserious$year, mc0remtfserious$yi, pch = 1, cex = sizeserious2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Serious", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecserious, predsserious2$pred, lwd = 2, col = "pink")
lines(yearvecserious, predsserious2$ci.lb, lty = "dashed")
lines(yearvecserious, predsserious2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
dev.off()



png("28. MRA plot according to NOS quality stars (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in all studies (using metafor)
mc0remtfstars<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset, append = TRUE)
mc0remtfmastars<-rma(yi, vi, data = mc0remtfstars, method = "REML", mods = ~stars)
starsvec<-seq(min(dset$stars), max(dset$stars), 1)
predsstars2<-predict(mc0remtfmastars, newmods = starsvec)
wistars2<-1/sqrt(mc0remtfstars$vi+mc0remtfmastars$tau2)
sizestars2<-1+2*(wistars2 - min(wistars2)) / (max(wistars2) - min(wistars2))
plot(mc0remtfstars$stars, mc0remtfstars$yi, pch = 1, cex = sizestars2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvec, predsstars2$pred, lwd = 2, col = "red")
lines(starsvec, predsstars2$ci.lb, lty = "dashed")
lines(starsvec, predsstars2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("29. MRA plot according to NOS quality stars in studies with or without patient matching.png", W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies with patient matching (using metafor)
mc0remtfstarsmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmastarsmatched<-rma(yi, vi, data = mc0remtfstarsmatched, method = "REML", mods = ~stars)
starsvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$stars), max(dset[dset$matching=="Studies with patient matching",]$stars), 1)
predsstarsmatched2<-predict(mc0remtfmastarsmatched, newmods = starsvecmatched)
wistarsmatched2<-1/sqrt(mc0remtfstarsmatched$vi+mc0remtfmastarsmatched$tau2)
sizestarsmatched2<-1+2*(wistarsmatched2 - min(wistarsmatched2)) / (max(wistarsmatched2) - min(wistarsmatched2))
plot(mc0remtfstarsmatched$stars, mc0remtfstarsmatched$yi, pch = 1, cex = sizestarsmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmatched, predsstarsmatched2$pred, lwd = 2, col = "darkgreen")
lines(starsvecmatched, predsstarsmatched2$ci.lb, lty = "dashed")
lines(starsvecmatched, predsstarsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies without patient matching (using metafor)
mc0remtfstarsnonmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmastarsnonmatched<-rma(yi, vi, data = mc0remtfstarsnonmatched, method = "REML", mods = ~stars)
starsvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$stars), max(dset[dset$matching=="Studies without patient matching",]$stars), 1)
predsstarsnonmatched2<-predict(mc0remtfmastarsnonmatched, newmods = starsvecnonmatched)
wistarsnonmatched2<-1/sqrt(mc0remtfstarsnonmatched$vi+mc0remtfmastarsnonmatched$tau2)
sizestarsnonmatched2<-1+2*(wistarsnonmatched2 - min(wistarsnonmatched2)) / (max(wistarsnonmatched2) - min(wistarsnonmatched2))
plot(mc0remtfstarsnonmatched$stars, mc0remtfstarsnonmatched$yi, pch = 1, cex = sizestarsnonmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecnonmatched, predsstarsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.lb, lty = "dashed")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("30. MRA plot according to NOS quality stars in single- or multicenter studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in multicenter studies (using metafor)
mc0remtfstarsmulti<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmastarsmulti<-rma(yi, vi, data = mc0remtfstarsmulti, method = "REML", mods = ~stars)
starsvecmulti<-seq(min(dset[dset$center=="Multicenter studies",]$stars), max(dset[dset$center=="Multicenter studies",]$stars), 1)
predsstarsmulti2<-predict(mc0remtfmastarsmulti, newmods = starsvecmulti)
wistarsmulti2<-1/sqrt(mc0remtfstarsmulti$vi+mc0remtfmastarsmulti$tau2)
sizestarsmulti2<-1+2*(wistarsmulti2 - min(wistarsmulti2)) / (max(wistarsmulti2) - min(wistarsmulti2))
plot(mc0remtfstarsmulti$stars, mc0remtfstarsmulti$yi, pch = 1, cex = sizestarsmulti2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmulti, predsstarsmulti2$pred, lwd = 2, col = "darkblue")
lines(starsvecmulti, predsstarsmulti2$ci.lb, lty = "dashed")
lines(starsvecmulti, predsstarsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in single-center studies (using metafor)
mc0remtfstarssingle<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmastarssingle<-rma(yi, vi, data = mc0remtfstarssingle, method = "REML", mods = ~stars)
starsvecsingle<-seq(min(dset[dset$center=="Single-center studies",]$stars), max(dset[dset$center=="Single-center studies",]$stars), 1)
predsstarssingle2<-predict(mc0remtfmastarssingle, newmods = starsvecsingle)
wistarssingle2<-1/sqrt(mc0remtfstarssingle$vi+mc0remtfmastarssingle$tau2)
sizestarssingle2<-1+2*(wistarssingle2 - min(wistarssingle2)) / (max(wistarssingle2) - min(wistarssingle2))
plot(mc0remtfstarssingle$stars, mc0remtfstarssingle$yi, pch = 1, cex = sizestarssingle2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in minor complication rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecsingle, predsstarssingle2$pred, lwd = 2, col = "lightblue")
lines(starsvecsingle, predsstarssingle2$ci.lb, lty = "dashed")
lines(starsvecsingle, predsstarssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


#################################################### PSM (REM) ##########################################################

#Now we define the dataset of interest
dset<-PSM

# First we define the order of reporting the different subgroups
order_post2018 <- c("Studies published after 2018", "Studies published before 2018")
order_matching <- c("Studies with patient matching", "Studies without patient matching")
order_center <- c("Multicenter studies", "Single-center studies")
order_robins <- c("Studies with ROBINS-I: Low", "Studies with ROBINS-I: Moderate", "Studies with ROBINS-I: Serious")

# Then we apply the predefined order of reporting to the dataset
dset$post2018 <- factor(dset$post2018, levels = order_post2018)
dset$matching <- factor(dset$matching, levels = order_matching)
dset$center <- factor(dset$center, levels = order_center)
dset$robins <- factor(dset$robins, levels = order_robins)


# Pooled meta analysis
png("31. Forest plot (pooled).png", width = 800, height = 700)
mc0re<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE)
forestmc0re<-forest(mc0re, text.addline1 = "Odds Ratio in positive surgical margin rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
weights_mc <- mc0re$w.random
dev.off()

png("32. Funnel plot.png", width = W_fr, height = H_fr)
# We set the margins to add space
# mar = c(bottom, left, top, right)
# mgp1: distance between the axis title and labels, mgp2: distance between the axis ticks and labels
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0))  
funnelmc0re<-funnel(mc0re, pch = 20,cex = 1, contour = c(0.9,0.95,0.99), col.contour = c("darkgray", "gray", "lightgray"), xlim = c(0.01,90), xlab = "", ylab = "", axes = TRUE)
legend(0.01, 0.01, c("0.1 > p > 0.05", "0.05 > p > 0.01", "p < 0.01"), fill = c("darkgray", "gray", "lightgray"), bty = "n", cex = 1.5)
title("Funnel plot with contours of statistical significance", cex.main = 2, xlab = "log Odds Ratio (logOR)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()

png("33. Radial plot with Egger's test.png", width = W_fr, height = H_fr)
radialmc0re<-radial(mc0re)
eggersmc0re<-metabias(mc0re, method.bias = "linreg", plotit = TRUE)
eggersmc0re
regmc0re<-lm(I(mc0re$TE/mc0re$seTE) ~ I(1/mc0re$seTE))
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
radial(mc0re, cex = 1.5, cex.lab = 1.5, axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
abline(regmc0re)
title("Radial plot with a solid regression line for Egger's test", cex.main = 2)
dev.off()

# Small study Effects
png("34. Funnel plot with small study effects.png", width = W_fr, height = H_fr)
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
l2<-limitmeta(mc0re)
funnel(l2, cex = 1.5, xlim = c(0.01,90), xlab = "", ylab = "", axes = TRUE)
print(l2, digits = 3)
title("Funnel plot with a curved regression line for small study effects", cex.main = 2, xlab = "log Odds Ratio (logOR)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()


# subgroup analysis (post2018)
png("35. Forest plot with subgroups according to publication year.png", width = 800, height = 850)
mc0repost2018<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = post2018, print.byvar = FALSE)
forestmc0repost2018<-forest(mc0repost2018, text.addline1 = "Odds Ratio in positive surgical margin rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (matching)
png("36. Forest plot with subgroups according to patient matching.png", width = 800, height = 850)
mc0rematched<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = matching, print.byvar = FALSE)
forestmc0rematched<-forest(mc0rematched, text.addline1 = "Odds Ratio in positive surgical margin rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (center)
png("37. Forest plot with subgroups according to the number of centers.png", width = 800, height = 850)
mc0recenter<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = center, print.byvar = FALSE)
forestmc0recenter<-forest(mc0recenter, text.addline1 = "Odds Ratio in positive surgical margin rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (robins)
png("38. Forest plot with subgroups according to ROBINS-I.png", width = 800, height = 850)
mc0rerobins<-metabin(evexp,nexp,evctrl,nctrl,sm="OR",method = "MH",data = dset, studlab = study, comb.fixed = FALSE, byvar = robins, print.byvar = FALSE)
forestmc0rerobins<-forest(mc0rerobins, text.addline1 = "Odds Ratio in positive surgical margin rates", text.addline2 = "Comparison: RPN / RAPN vs. OPN", showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()


# Meta Regression Analysis for publication year in all studies (using metafor)
png("39. MRA plot according to publication year (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
mc0remtf<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset, append = TRUE)
mc0remtfma<-rma(yi, vi, data = mc0remtf, method = "REML", mods = ~year)
yearvec<-seq(min(dset$year), max(dset$year), 1)
preds2<-predict(mc0remtfma, newmods = yearvec)
wi2<-1/sqrt(mc0remtf$vi+mc0remtfma$tau2)
size2<-1+2*(wi2 - min(wi2)) / (max(wi2) - min(wi2))
plot(mc0remtf$year, mc0remtf$yi, pch = 1, cex = size2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvec, preds2$pred, lwd = 2, col = "red")
lines(yearvec, preds2$ci.lb, lty = "dashed")
lines(yearvec, preds2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("40. MRA plot according to publication year in studies with or without patient matching.png", width = W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in studies with patient matching (using metafor)
mc0remtfmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmamatched<-rma(yi, vi, data = mc0remtfmatched, method = "REML", mods = ~year)
yearvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$year), max(dset[dset$matching=="Studies with patient matching",]$year), 1)
predsmatched2<-predict(mc0remtfmamatched, newmods = yearvecmatched)
wimatched2<-1/sqrt(mc0remtfmatched$vi+mc0remtfmamatched$tau2)
sizematched2<- 1+2*(wimatched2 - min(wimatched2)) / (max(wimatched2) - min(wimatched2))
plot(mc0remtfmatched$year, mc0remtfmatched$yi, pch = 1, cex = sizematched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmatched, predsmatched2$pred, lwd = 2, col = "darkgreen")
lines(yearvecmatched, predsmatched2$ci.lb, lty = "dashed")
lines(yearvecmatched, predsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in studies without patient matching (using metafor)
mc0remtfnonmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmanonmatched<-rma(yi, vi, data = mc0remtfnonmatched, method = "REML", mods = ~year)
yearvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$year), max(dset[dset$matching=="Studies without patient matching",]$year), 1)
predsnonmatched2<-predict(mc0remtfmanonmatched, newmods = yearvecnonmatched)
winonmatched2<-1/sqrt(mc0remtfnonmatched$vi+mc0remtfmanonmatched$tau2)
sizenonmatched2<- 1+2*(winonmatched2 - min(winonmatched2)) / (max(winonmatched2) - min(winonmatched2))
plot(mc0remtfnonmatched$year, mc0remtfnonmatched$yi, pch = 1, cex = sizenonmatched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecnonmatched, predsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(yearvecnonmatched, predsnonmatched2$ci.lb, lty = "dashed")
lines(yearvecnonmatched, predsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("41. MRA plot according to publication year in multi- or single-center studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in multicenter studies (using metafor)
mc0remtfmulti<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmamulti<-rma(yi, vi, data = mc0remtfmulti, method = "REML", mods = ~year)
yearvecmulti<-seq(min(data = dset[dset$center=="Multicenter studies",]$year), max(data = dset[dset$center=="Multicenter studies",]$year), 1)
predsmulti2<-predict(mc0remtfmamulti, newmods = yearvecmulti)
wimulti2<-1/sqrt(mc0remtfmulti$vi+mc0remtfmamulti$tau2)
sizemulti2<- 1+2*(wimulti2 - min(wimulti2)) / (max(wimulti2) - min(wimulti2))
plot(mc0remtfmulti$year, mc0remtfmulti$yi, pch = 1, cex = sizemulti2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmulti, predsmulti2$pred, lwd = 2, col = "darkblue")
lines(yearvecmulti, predsmulti2$ci.lb, lty = "dashed")
lines(yearvecmulti, predsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in single-center studies (using metafor)
mc0remtfsingle<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmasingle<-rma(yi, vi, data = mc0remtfsingle, method = "REML", mods = ~year)
yearvecsingle<-seq(min(data = dset[dset$center=="Single-center studies",]$year), max(data = dset[dset$center=="Single-center studies",]$year), 1)
predssingle2<-predict(mc0remtfmasingle, newmods = yearvecsingle)
wisingle2<-1/sqrt(mc0remtfsingle$vi+mc0remtfmasingle$tau2)
sizesingle2<- 1+2*(wisingle2 - min(wisingle2)) / (max(wisingle2) - min(wisingle2))
plot(mc0remtfsingle$year, mc0remtfsingle$yi, pch = 1, cex = sizesingle2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecsingle, predssingle2$pred, lwd = 2, col = "lightblue")
lines(yearvecsingle, predssingle2$ci.lb, lty = "dashed")
lines(yearvecsingle, predssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("42. MRA plot according to publication year in studies with low - moderate - serious risk of bias.png", width = W_robins, height = H_robins)
par(mfrow = c(3, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in ROBINS-I: "Low Risk of Bias" studies (using metafor)
mc0remtflow<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Low",], append = TRUE)
mc0remtfmalow<-rma(yi, vi, data = mc0remtflow, method = "REML", mods = ~year)
yearveclow<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), 1)
predslow2<-predict(mc0remtfmalow, newmods = yearveclow)
wilow2<-1/sqrt(mc0remtflow$vi+mc0remtfmalow$tau2)
sizelow2<- 1+2*(wilow2 - min(wilow2)) / (max(wilow2) - min(wilow2))
plot(mc0remtflow$year, mc0remtflow$yi, pch = 1, cex = sizelow2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Low", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearveclow, predslow2$pred, lwd = 2, col = "purple")
lines(yearveclow, predslow2$ci.lb, lty = "dashed")
lines(yearveclow, predslow2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Moderate Risk of Bias" studies (using metafor)
mc0remtfmoderate<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Moderate",], append = TRUE)
mc0remtfmamoderate<-rma(yi, vi, data = mc0remtfmoderate, method = "REML", mods = ~year)
yearvecmoderate<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), 1)
predsmoderate2<-predict(mc0remtfmamoderate, newmods = yearvecmoderate)
wimoderate2<-1/sqrt(mc0remtfmoderate$vi+mc0remtfmamoderate$tau2)
sizemoderate2<- 1+2*(wimoderate2 - min(wimoderate2)) / (max(wimoderate2) - min(wimoderate2))
plot(mc0remtfmoderate$year, mc0remtfmoderate$yi, pch = 1, cex = sizemoderate2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Moderate", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecmoderate, predsmoderate2$pred, lwd = 2, col = "magenta")
lines(yearvecmoderate, predsmoderate2$ci.lb, lty = "dashed")
lines(yearvecmoderate, predsmoderate2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Serious Risk of Bias" studies (using metafor)
mc0remtfserious<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$robins=="Studies with ROBINS-I: Serious",], append = TRUE)
mc0remtfmaserious<-rma(yi, vi, data = mc0remtfserious, method = "REML", mods = ~year)
yearvecserious<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), 1)
predsserious2<-predict(mc0remtfmaserious, newmods = yearvecserious)
wiserious2<-1/sqrt(mc0remtfserious$vi+mc0remtfmaserious$tau2)
sizeserious2<- 1+2*(wiserious2 - min(wiserious2)) / (max(wiserious2) - min(wiserious2))
plot(mc0remtfserious$year, mc0remtfserious$yi, pch = 1, cex = sizeserious2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Serious", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecserious, predsserious2$pred, lwd = 2, col = "pink")
lines(yearvecserious, predsserious2$ci.lb, lty = "dashed")
lines(yearvecserious, predsserious2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
dev.off()



png("43. MRA plot according to NOS quality stars (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in all studies (using metafor)
mc0remtfstars<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset, append = TRUE)
mc0remtfmastars<-rma(yi, vi, data = mc0remtfstars, method = "REML", mods = ~stars)
starsvec<-seq(min(dset$stars), max(dset$stars), 1)
predsstars2<-predict(mc0remtfmastars, newmods = starsvec)
wistars2<-1/sqrt(mc0remtfstars$vi+mc0remtfmastars$tau2)
sizestars2<-1+2*(wistars2 - min(wistars2)) / (max(wistars2) - min(wistars2))
plot(mc0remtfstars$stars, mc0remtfstars$yi, pch = 1, cex = sizestars2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvec, predsstars2$pred, lwd = 2, col = "red")
lines(starsvec, predsstars2$ci.lb, lty = "dashed")
lines(starsvec, predsstars2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("44. MRA plot according to NOS quality stars in studies with or without patient matching.png", W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies with patient matching (using metafor)
mc0remtfstarsmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmastarsmatched<-rma(yi, vi, data = mc0remtfstarsmatched, method = "REML", mods = ~stars)
starsvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$stars), max(dset[dset$matching=="Studies with patient matching",]$stars), 1)
predsstarsmatched2<-predict(mc0remtfmastarsmatched, newmods = starsvecmatched)
wistarsmatched2<-1/sqrt(mc0remtfstarsmatched$vi+mc0remtfmastarsmatched$tau2)
sizestarsmatched2<-1+2*(wistarsmatched2 - min(wistarsmatched2)) / (max(wistarsmatched2) - min(wistarsmatched2))
plot(mc0remtfstarsmatched$stars, mc0remtfstarsmatched$yi, pch = 1, cex = sizestarsmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmatched, predsstarsmatched2$pred, lwd = 2, col = "darkgreen")
lines(starsvecmatched, predsstarsmatched2$ci.lb, lty = "dashed")
lines(starsvecmatched, predsstarsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies without patient matching (using metafor)
mc0remtfstarsnonmatched<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmastarsnonmatched<-rma(yi, vi, data = mc0remtfstarsnonmatched, method = "REML", mods = ~stars)
starsvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$stars), max(dset[dset$matching=="Studies without patient matching",]$stars), 1)
predsstarsnonmatched2<-predict(mc0remtfmastarsnonmatched, newmods = starsvecnonmatched)
wistarsnonmatched2<-1/sqrt(mc0remtfstarsnonmatched$vi+mc0remtfmastarsnonmatched$tau2)
sizestarsnonmatched2<-1+2*(wistarsnonmatched2 - min(wistarsnonmatched2)) / (max(wistarsnonmatched2) - min(wistarsnonmatched2))
plot(mc0remtfstarsnonmatched$stars, mc0remtfstarsnonmatched$yi, pch = 1, cex = sizestarsnonmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecnonmatched, predsstarsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.lb, lty = "dashed")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("45. MRA plot according to NOS quality stars in single- or multicenter studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in multicenter studies (using metafor)
mc0remtfstarsmulti<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmastarsmulti<-rma(yi, vi, data = mc0remtfstarsmulti, method = "REML", mods = ~stars)
starsvecmulti<-seq(min(dset[dset$center=="Multicenter studies",]$stars), max(dset[dset$center=="Multicenter studies",]$stars), 1)
predsstarsmulti2<-predict(mc0remtfmastarsmulti, newmods = starsvecmulti)
wistarsmulti2<-1/sqrt(mc0remtfstarsmulti$vi+mc0remtfmastarsmulti$tau2)
sizestarsmulti2<-1+2*(wistarsmulti2 - min(wistarsmulti2)) / (max(wistarsmulti2) - min(wistarsmulti2))
plot(mc0remtfstarsmulti$stars, mc0remtfstarsmulti$yi, pch = 1, cex = sizestarsmulti2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmulti, predsstarsmulti2$pred, lwd = 2, col = "darkblue")
lines(starsvecmulti, predsstarsmulti2$ci.lb, lty = "dashed")
lines(starsvecmulti, predsstarsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in single-center studies (using metafor)
mc0remtfstarssingle<-escalc(measure = "OR",ai = evexp, bi = nonevexp, ci = evctrl, di = nonevctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmastarssingle<-rma(yi, vi, data = mc0remtfstarssingle, method = "REML", mods = ~stars)
starsvecsingle<-seq(min(dset[dset$center=="Single-center studies",]$stars), max(dset[dset$center=="Single-center studies",]$stars), 1)
predsstarssingle2<-predict(mc0remtfmastarssingle, newmods = starsvecsingle)
wistarssingle2<-1/sqrt(mc0remtfstarssingle$vi+mc0remtfmastarssingle$tau2)
sizestarssingle2<-1+2*(wistarssingle2 - min(wistarssingle2)) / (max(wistarssingle2) - min(wistarssingle2))
plot(mc0remtfstarssingle$stars, mc0remtfstarssingle$yi, pch = 1, cex = sizestarssingle2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "log Odds Ratio in positive surgical margin rates (RPN / RAPN vs. OPN)", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecsingle, predsstarssingle2$pred, lwd = 2, col = "lightblue")
lines(starsvecsingle, predsstarssingle2$ci.lb, lty = "dashed")
lines(starsvecsingle, predsstarssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


#################################################### IT (REM) ##########################################################

#Now we define the dataset of interest
dset<-IT

# First we define the order of reporting the different subgroups
order_post2018 <- c("Studies published after 2018", "Studies published before 2018")
order_matching <- c("Studies with patient matching", "Studies without patient matching")
order_center <- c("Multicenter studies", "Single-center studies")
order_robins <- c("Studies with ROBINS-I: Low", "Studies with ROBINS-I: Moderate", "Studies with ROBINS-I: Serious")

# Then we apply the predefined order of reporting to the dataset
dset$post2018 <- factor(dset$post2018, levels = order_post2018)
dset$matching <- factor(dset$matching, levels = order_matching)
dset$center <- factor(dset$center, levels = order_center)
dset$robins <- factor(dset$robins, levels = order_robins)


# Pooled meta analysis
png("46. Forest plot (pooled).png", width = 900, height = 850)
mc0re<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, studlab = study, comb.fixed = FALSE, hakn = TRUE)
forestmc0re<-forest(mc0re, text.addline1 = "Mean Difference in ischemia time (min)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0re$lower,3))-0.1, max(round(mc0re$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
weights_mc <- mc0re$w.random
dev.off()

png("47. Funnel plot.png", width = W_fr, height = H_fr)
# We set the margins to add space
# mar = c(bottom, left, top, right)
# mgp1: distance between the axis title and labels, mgp2: distance between the axis ticks and labels
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0))  
funnelmc0re<-funnel(mc0re, pch = 20,cex = 1, contour = c(0.9,0.95,0.99), col.contour = c("darkgray", "gray", "lightgray"), xlim = c(min(round(mc0re$TE,3))-0.1, max(round(mc0re$TE,3))+2.5), xlab = "", ylab = "", axes = FALSE)
# First we draw a rectangle by obtaining the coordinates of the plot
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
legend(min(round(mc0re$TE,3)), 0, c("0.1 > p > 0.05", "0.05 > p > 0.01", "p < 0.01"), fill = c("darkgray", "gray", "lightgray"), bty = "n", cex = 1.5)
title("Funnel plot with contours of statistical significance", cex.main = 2, xlab = "Mean Difference (MD)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()

png("48. Radial plot with Egger's test.png", width = W_fr, height = H_fr)
radialmc0re<-radial(mc0re)
eggersmc0re<-metabias(mc0re, method.bias = "linreg", plotit = TRUE)
eggersmc0re
regmc0re<-lm(I(mc0re$TE/mc0re$seTE) ~ I(1/mc0re$seTE))
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
radial(mc0re, cex = 1.5, cex.lab = 1.5, axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
abline(regmc0re)
title("Radial plot with a solid regression line for Egger's test", cex.main = 2)
dev.off()

# Small study Effects
png("49. Funnel plot with small study effects.png", width = W_fr, height = H_fr)
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
l2<-limitmeta(mc0re)
funnel(l2, cex = 1.5, xlim = c(min(round(mc0re$TE,3))-0.1, max(round(mc0re$TE,3))+2.5), xlab = "", ylab = "", axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
print(l2, digits = 3)
title("Funnel plot with a curved regression line for small study effects", cex.main = 2, xlab = "Mean Difference (MD)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()


# subgroup analysis (post2018)
png("50. Forest plot with subgroups according to publication year.png", width = 900, height = 1000)
mc0repost2018<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = post2018, print.byvar = FALSE)
forestmc0repost2018<-forest(mc0repost2018, text.addline1 = "Mean Difference in ischemia time (min)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0repost2018$lower,3))-0.1, max(round(mc0repost2018$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (matching)
png("51. Forest plot with subgroups according to patient matching.png", width = 900, height = 1000)
mc0rematched<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = matching, print.byvar = FALSE)
forestmc0rematched<-forest(mc0rematched, text.addline1 = "Mean Difference in ischemia time (min)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0rematched$lower,3))-0.1, max(round(mc0rematched$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (center)
png("52. Forest plot with subgroups according to the number of centers.png", width = 900, height = 1000)
mc0recenter<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = center, print.byvar = FALSE)
forestmc0recenter<-forest(mc0recenter, text.addline1 = "Mean Difference in ischemia time (min)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0recenter$lower,3))-0.1, max(round(mc0recenter$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (robins)
png("53. Forest plot with subgroups according to ROBINS-I.png", width = 900, height = 1000)
mc0rerobins<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = robins, print.byvar = FALSE)
forestmc0rerobins<-forest(mc0rerobins, text.addline1 = "Mean Difference in ischemia time (min)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0rerobins$lower,3))-0.1, max(round(mc0rerobins$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()


# Meta Regression Analysis for publication year in all studies (using metafor)
png("54. MRA plot according to publication year (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
mc0remtf<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset, append = TRUE)
mc0remtfma<-rma(yi, vi, data = mc0remtf, method = "REML", mods = ~year)
yearvec<-seq(min(dset$year), max(dset$year), 1)
preds2<-predict(mc0remtfma, newmods = yearvec)
wi2<-1/sqrt(mc0remtf$vi+mc0remtfma$tau2)
size2<-1+2*(wi2 - min(wi2)) / (max(wi2) - min(wi2))
plot(mc0remtf$year, mc0remtf$yi, pch = 1, cex = size2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvec, preds2$pred, lwd = 2, col = "red")
lines(yearvec, preds2$ci.lb, lty = "dashed")
lines(yearvec, preds2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("55. MRA plot according to publication year in studies with or without patient matching.png", width = W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in studies with patient matching (using metafor)
mc0remtfmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmamatched<-rma(yi, vi, data = mc0remtfmatched, method = "REML", mods = ~year)
yearvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$year), max(dset[dset$matching=="Studies with patient matching",]$year), 1)
predsmatched2<-predict(mc0remtfmamatched, newmods = yearvecmatched)
wimatched2<-1/sqrt(mc0remtfmatched$vi+mc0remtfmamatched$tau2)
sizematched2<- 1+2*(wimatched2 - min(wimatched2)) / (max(wimatched2) - min(wimatched2))
plot(mc0remtfmatched$year, mc0remtfmatched$yi, pch = 1, cex = sizematched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmatched, predsmatched2$pred, lwd = 2, col = "darkgreen")
lines(yearvecmatched, predsmatched2$ci.lb, lty = "dashed")
lines(yearvecmatched, predsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in studies without patient matching (using metafor)
mc0remtfnonmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmanonmatched<-rma(yi, vi, data = mc0remtfnonmatched, method = "REML", mods = ~year)
yearvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$year), max(dset[dset$matching=="Studies without patient matching",]$year), 1)
predsnonmatched2<-predict(mc0remtfmanonmatched, newmods = yearvecnonmatched)
winonmatched2<-1/sqrt(mc0remtfnonmatched$vi+mc0remtfmanonmatched$tau2)
sizenonmatched2<- 1+2*(winonmatched2 - min(winonmatched2)) / (max(winonmatched2) - min(winonmatched2))
plot(mc0remtfnonmatched$year, mc0remtfnonmatched$yi, pch = 1, cex = sizenonmatched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecnonmatched, predsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(yearvecnonmatched, predsnonmatched2$ci.lb, lty = "dashed")
lines(yearvecnonmatched, predsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("56. MRA plot according to publication year in multi- or single-center studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in multicenter studies (using metafor)
mc0remtfmulti<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmamulti<-rma(yi, vi, data = mc0remtfmulti, method = "REML", mods = ~year)
yearvecmulti<-seq(min(data = dset[dset$center=="Multicenter studies",]$year), max(data = dset[dset$center=="Multicenter studies",]$year), 1)
predsmulti2<-predict(mc0remtfmamulti, newmods = yearvecmulti)
wimulti2<-1/sqrt(mc0remtfmulti$vi+mc0remtfmamulti$tau2)
sizemulti2<- 1+2*(wimulti2 - min(wimulti2)) / (max(wimulti2) - min(wimulti2))
plot(mc0remtfmulti$year, mc0remtfmulti$yi, pch = 1, cex = sizemulti2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmulti, predsmulti2$pred, lwd = 2, col = "darkblue")
lines(yearvecmulti, predsmulti2$ci.lb, lty = "dashed")
lines(yearvecmulti, predsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in single-center studies (using metafor)
mc0remtfsingle<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmasingle<-rma(yi, vi, data = mc0remtfsingle, method = "REML", mods = ~year)
yearvecsingle<-seq(min(data = dset[dset$center=="Single-center studies",]$year), max(data = dset[dset$center=="Single-center studies",]$year), 1)
predssingle2<-predict(mc0remtfmasingle, newmods = yearvecsingle)
wisingle2<-1/sqrt(mc0remtfsingle$vi+mc0remtfmasingle$tau2)
sizesingle2<- 1+2*(wisingle2 - min(wisingle2)) / (max(wisingle2) - min(wisingle2))
plot(mc0remtfsingle$year, mc0remtfsingle$yi, pch = 1, cex = sizesingle2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecsingle, predssingle2$pred, lwd = 2, col = "lightblue")
lines(yearvecsingle, predssingle2$ci.lb, lty = "dashed")
lines(yearvecsingle, predssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("57. MRA plot according to publication year in studies with low - moderate - serious risk of bias.png", width = W_robins, height = H_robins)
par(mfrow = c(3, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in ROBINS-I: "Low Risk of Bias" studies (using metafor)
mc0remtflow<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Low",], append = TRUE)
mc0remtfmalow<-rma(yi, vi, data = mc0remtflow, method = "REML", mods = ~year)
yearveclow<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), 1)
predslow2<-predict(mc0remtfmalow, newmods = yearveclow)
wilow2<-1/sqrt(mc0remtflow$vi+mc0remtfmalow$tau2)
sizelow2<- 1+2*(wilow2 - min(wilow2)) / (max(wilow2) - min(wilow2))
plot(mc0remtflow$year, mc0remtflow$yi, pch = 1, cex = sizelow2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Low", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearveclow, predslow2$pred, lwd = 2, col = "purple")
lines(yearveclow, predslow2$ci.lb, lty = "dashed")
lines(yearveclow, predslow2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Moderate Risk of Bias" studies (using metafor)
mc0remtfmoderate<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Moderate",], append = TRUE)
mc0remtfmamoderate<-rma(yi, vi, data = mc0remtfmoderate, method = "REML", mods = ~year)
yearvecmoderate<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), 1)
predsmoderate2<-predict(mc0remtfmamoderate, newmods = yearvecmoderate)
wimoderate2<-1/sqrt(mc0remtfmoderate$vi+mc0remtfmamoderate$tau2)
sizemoderate2<- 1+2*(wimoderate2 - min(wimoderate2)) / (max(wimoderate2) - min(wimoderate2))
plot(mc0remtfmoderate$year, mc0remtfmoderate$yi, pch = 1, cex = sizemoderate2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Moderate", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecmoderate, predsmoderate2$pred, lwd = 2, col = "magenta")
lines(yearvecmoderate, predsmoderate2$ci.lb, lty = "dashed")
lines(yearvecmoderate, predsmoderate2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Serious Risk of Bias" studies (using metafor)
mc0remtfserious<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Serious",], append = TRUE)
mc0remtfmaserious<-rma(yi, vi, data = mc0remtfserious, method = "REML", mods = ~year)
yearvecserious<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), 1)
predsserious2<-predict(mc0remtfmaserious, newmods = yearvecserious)
wiserious2<-1/sqrt(mc0remtfserious$vi+mc0remtfmaserious$tau2)
sizeserious2<- 1+2*(wiserious2 - min(wiserious2)) / (max(wiserious2) - min(wiserious2))
plot(mc0remtfserious$year, mc0remtfserious$yi, pch = 1, cex = sizeserious2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Serious", cex.main = 2.2, cex.lab = 1.7, xaxt = "n", yaxt = "n")
lines(yearvecserious, predsserious2$pred, lwd = 2, col = "pink")
lines(yearvecserious, predsserious2$ci.lb, lty = "dashed")
lines(yearvecserious, predsserious2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
dev.off()



png("58. MRA plot according to NOS quality stars (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in all studies (using metafor)
mc0remtfstars<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset, append = TRUE)
mc0remtfmastars<-rma(yi, vi, data = mc0remtfstars, method = "REML", mods = ~stars)
starsvec<-seq(min(dset$stars), max(dset$stars), 1)
predsstars2<-predict(mc0remtfmastars, newmods = starsvec)
wistars2<-1/sqrt(mc0remtfstars$vi+mc0remtfmastars$tau2)
sizestars2<-1+2*(wistars2 - min(wistars2)) / (max(wistars2) - min(wistars2))
plot(mc0remtfstars$stars, mc0remtfstars$yi, pch = 1, cex = sizestars2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvec, predsstars2$pred, lwd = 2, col = "red")
lines(starsvec, predsstars2$ci.lb, lty = "dashed")
lines(starsvec, predsstars2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("59. MRA plot according to NOS quality stars in studies with or without patient matching.png", W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies with patient matching (using metafor)
mc0remtfstarsmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmastarsmatched<-rma(yi, vi, data = mc0remtfstarsmatched, method = "REML", mods = ~stars)
starsvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$stars), max(dset[dset$matching=="Studies with patient matching",]$stars), 1)
predsstarsmatched2<-predict(mc0remtfmastarsmatched, newmods = starsvecmatched)
wistarsmatched2<-1/sqrt(mc0remtfstarsmatched$vi+mc0remtfmastarsmatched$tau2)
sizestarsmatched2<-1+2*(wistarsmatched2 - min(wistarsmatched2)) / (max(wistarsmatched2) - min(wistarsmatched2))
plot(mc0remtfstarsmatched$stars, mc0remtfstarsmatched$yi, pch = 1, cex = sizestarsmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmatched, predsstarsmatched2$pred, lwd = 2, col = "darkgreen")
lines(starsvecmatched, predsstarsmatched2$ci.lb, lty = "dashed")
lines(starsvecmatched, predsstarsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies without patient matching (using metafor)
mc0remtfstarsnonmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmastarsnonmatched<-rma(yi, vi, data = mc0remtfstarsnonmatched, method = "REML", mods = ~stars)
starsvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$stars), max(dset[dset$matching=="Studies without patient matching",]$stars), 1)
predsstarsnonmatched2<-predict(mc0remtfmastarsnonmatched, newmods = starsvecnonmatched)
wistarsnonmatched2<-1/sqrt(mc0remtfstarsnonmatched$vi+mc0remtfmastarsnonmatched$tau2)
sizestarsnonmatched2<-1+2*(wistarsnonmatched2 - min(wistarsnonmatched2)) / (max(wistarsnonmatched2) - min(wistarsnonmatched2))
plot(mc0remtfstarsnonmatched$stars, mc0remtfstarsnonmatched$yi, pch = 1, cex = sizestarsnonmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecnonmatched, predsstarsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.lb, lty = "dashed")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("60. MRA plot according to NOS quality stars in single- or multicenter studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in multicenter studies (using metafor)
mc0remtfstarsmulti<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmastarsmulti<-rma(yi, vi, data = mc0remtfstarsmulti, method = "REML", mods = ~stars)
starsvecmulti<-seq(min(dset[dset$center=="Multicenter studies",]$stars), max(dset[dset$center=="Multicenter studies",]$stars), 1)
predsstarsmulti2<-predict(mc0remtfmastarsmulti, newmods = starsvecmulti)
wistarsmulti2<-1/sqrt(mc0remtfstarsmulti$vi+mc0remtfmastarsmulti$tau2)
sizestarsmulti2<-1+2*(wistarsmulti2 - min(wistarsmulti2)) / (max(wistarsmulti2) - min(wistarsmulti2))
plot(mc0remtfstarsmulti$stars, mc0remtfstarsmulti$yi, pch = 1, cex = sizestarsmulti2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecmulti, predsstarsmulti2$pred, lwd = 2, col = "darkblue")
lines(starsvecmulti, predsstarsmulti2$ci.lb, lty = "dashed")
lines(starsvecmulti, predsstarsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in single-center studies (using metafor)
mc0remtfstarssingle<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmastarssingle<-rma(yi, vi, data = mc0remtfstarssingle, method = "REML", mods = ~stars)
starsvecsingle<-seq(min(dset[dset$center=="Single-center studies",]$stars), max(dset[dset$center=="Single-center studies",]$stars), 1)
predsstarssingle2<-predict(mc0remtfmastarssingle, newmods = starsvecsingle)
wistarssingle2<-1/sqrt(mc0remtfstarssingle$vi+mc0remtfmastarssingle$tau2)
sizestarssingle2<-1+2*(wistarssingle2 - min(wistarssingle2)) / (max(wistarssingle2) - min(wistarssingle2))
plot(mc0remtfstarssingle$stars, mc0remtfstarssingle$yi, pch = 1, cex = sizestarssingle2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in ischemia time (RPN / RAPN vs. OPN) in min", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvecsingle, predsstarssingle2$pred, lwd = 2, col = "lightblue")
lines(starsvecsingle, predsstarssingle2$ci.lb, lty = "dashed")
lines(starsvecsingle, predsstarssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


#################################################### ΔEGFR (REM) ##########################################################

#Now we define the dataset of interest
dset<-ΔEGFR

# First we define the order of reporting the different subgroups
order_post2018 <- c("Studies published after 2018", "Studies published before 2018")
order_matching <- c("Studies with patient matching", "Studies without patient matching")
order_center <- c("Multicenter studies", "Single-center studies")
order_robins <- c("Studies with ROBINS-I: Low", "Studies with ROBINS-I: Moderate", "Studies with ROBINS-I: Serious")

# Then we apply the predefined order of reporting to the dataset
dset$post2018 <- factor(dset$post2018, levels = order_post2018)
dset$matching <- factor(dset$matching, levels = order_matching)
dset$center <- factor(dset$center, levels = order_center)
dset$robins <- factor(dset$robins, levels = order_robins)


# Pooled meta analysis
png("61. Forest plot (pooled).png", width = 850, height = 550)
mc0re<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, studlab = study, comb.fixed = FALSE, hakn = TRUE)
forestmc0re<-forest(mc0re, text.addline1 = "Mean Difference in eGFR change from baseline (ml/min/1.73m²)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0re$lower,3))-0.1, max(round(mc0re$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours RPN / RAPN", label.left = "Favours OPN", just = "center")
weights_mc <- mc0re$w.random
dev.off()

png("62. Funnel plot.png", width = W_fr, height = H_fr)
# We set the margins to add space
# mar = c(bottom, left, top, right)
# mgp1: distance between the axis title and labels, mgp2: distance between the axis ticks and labels
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0))  
funnelmc0re<-funnel(mc0re, pch = 20,cex = 1, contour = c(0.9,0.95,0.99), col.contour = c("darkgray", "gray", "lightgray"), xlim = c(-20,20), xlab = "", ylab = "", axes = FALSE)
# First we draw a rectangle by obtaining the coordinates of the plot
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
legend(-20, 0.8, c("0.1 > p > 0.05", "0.05 > p > 0.01", "p < 0.01"), fill = c("darkgray", "gray", "lightgray"), bty = "n", cex = 1.5)
title("Funnel plot with contours of statistical significance", cex.main = 2, xlab = "Mean Difference (MD)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()

png("63. Radial plot with Egger's test.png", width = W_fr, height = H_fr)
radialmc0re<-radial(mc0re)
eggersmc0re<-metabias(mc0re, method.bias = "linreg", plotit = TRUE)
eggersmc0re
regmc0re<-lm(I(mc0re$TE/mc0re$seTE) ~ I(1/mc0re$seTE))
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
radial(mc0re, cex = 1.5, cex.lab = 1.5, axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
abline(regmc0re)
title("Radial plot with a solid regression line for Egger's test", cex.main = 2)
dev.off()

# Small study Effects
png("64. Funnel plot with small study effects.png", width = W_fr, height = H_fr)
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
l2<-limitmeta(mc0re)
funnel(l2, cex = 1.5, xlim = c(-15,15), xlab = "", ylab = "", axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
print(l2, digits = 3)
title("Funnel plot with a curved regression line for small study effects", cex.main = 2, xlab = "Mean Difference (MD)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()


# subgroup analysis (post2018)
png("65. Forest plot with subgroups according to publication year.png", width = 850, height = 750)
mc0repost2018<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = post2018, print.byvar = FALSE)
forestmc0repost2018<-forest(mc0repost2018, text.addline1 = "Mean Difference in eGFR change from baseline (ml/min/1.73m²)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0repost2018$lower,3))-0.1, max(round(mc0repost2018$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours RPN / RAPN", label.left = "Favours OPN", just = "center")
dev.off()

# subgroup analysis (matching)
png("66. Forest plot with subgroups according to patient matching.png", width = 850, height = 750)
mc0rematched<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = matching, print.byvar = FALSE)
forestmc0rematched<-forest(mc0rematched, text.addline1 = "Mean Difference in eGFR change from baseline (ml/min/1.73m²)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0rematched$lower,3))-0.1, max(round(mc0rematched$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours RPN / RAPN", label.left = "Favours OPN", just = "center")
dev.off()

# subgroup analysis (center)
png("67. Forest plot with subgroups according to the number of centers.png", width = 850, height = 750)
mc0recenter<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = center, print.byvar = FALSE)
forestmc0recenter<-forest(mc0recenter, text.addline1 = "Mean Difference in eGFR change from baseline (ml/min/1.73m²)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0recenter$lower,3))-0.1, max(round(mc0recenter$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours RPN / RAPN", label.left = "Favours OPN", just = "center")
dev.off()

# subgroup analysis (robins)
png("68. Forest plot with subgroups according to ROBINS-I.png", width = 850, height = 750)
mc0rerobins<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = robins, print.byvar = FALSE)
forestmc0rerobins<-forest(mc0rerobins, text.addline1 = "Mean Difference in eGFR change from baseline (ml/min/1.73m²)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0rerobins$lower,3))-0.1, max(round(mc0rerobins$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours RPN / RAPN", label.left = "Favours OPN", just = "center")
dev.off()


# Meta Regression Analysis for publication year in all studies (using metafor)
png("69. MRA plot according to publication year (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
mc0remtf<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset, append = TRUE)
mc0remtfma<-rma(yi, vi, data = mc0remtf, method = "REML", mods = ~year)
yearvec<-seq(min(dset$year), max(dset$year), 1)
preds2<-predict(mc0remtfma, newmods = yearvec)
wi2<-1/sqrt(mc0remtf$vi+mc0remtfma$tau2)
size2<-1+2*(wi2 - min(wi2)) / (max(wi2) - min(wi2))
plot(mc0remtf$year, mc0remtf$yi, pch = 1, cex = size2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvec, preds2$pred, lwd = 2, col = "red")
lines(yearvec, preds2$ci.lb, lty = "dashed")
lines(yearvec, preds2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("70. MRA plot according to publication year in studies with or without patient matching.png", width = W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in studies with patient matching (using metafor)
mc0remtfmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmamatched<-rma(yi, vi, data = mc0remtfmatched, method = "REML", mods = ~year)
yearvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$year), max(dset[dset$matching=="Studies with patient matching",]$year), 1)
predsmatched2<-predict(mc0remtfmamatched, newmods = yearvecmatched)
wimatched2<-1/sqrt(mc0remtfmatched$vi+mc0remtfmamatched$tau2)
sizematched2<- 1+2*(wimatched2 - min(wimatched2)) / (max(wimatched2) - min(wimatched2))
plot(mc0remtfmatched$year, mc0remtfmatched$yi, pch = 1, cex = sizematched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecmatched, predsmatched2$pred, lwd = 2, col = "darkgreen")
lines(yearvecmatched, predsmatched2$ci.lb, lty = "dashed")
lines(yearvecmatched, predsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in studies without patient matching (using metafor)
mc0remtfnonmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmanonmatched<-rma(yi, vi, data = mc0remtfnonmatched, method = "REML", mods = ~year)
yearvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$year), max(dset[dset$matching=="Studies without patient matching",]$year), 1)
predsnonmatched2<-predict(mc0remtfmanonmatched, newmods = yearvecnonmatched)
winonmatched2<-1/sqrt(mc0remtfnonmatched$vi+mc0remtfmanonmatched$tau2)
sizenonmatched2<- 1+2*(winonmatched2 - min(winonmatched2)) / (max(winonmatched2) - min(winonmatched2))
plot(mc0remtfnonmatched$year, mc0remtfnonmatched$yi, pch = 1, cex = sizenonmatched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecnonmatched, predsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(yearvecnonmatched, predsnonmatched2$ci.lb, lty = "dashed")
lines(yearvecnonmatched, predsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("71. MRA plot according to publication year in multi- or single-center studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in multicenter studies (using metafor)
mc0remtfmulti<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmamulti<-rma(yi, vi, data = mc0remtfmulti, method = "REML", mods = ~year)
yearvecmulti<-seq(min(data = dset[dset$center=="Multicenter studies",]$year), max(data = dset[dset$center=="Multicenter studies",]$year), 1)
predsmulti2<-predict(mc0remtfmamulti, newmods = yearvecmulti)
wimulti2<-1/sqrt(mc0remtfmulti$vi+mc0remtfmamulti$tau2)
sizemulti2<- 1+2*(wimulti2 - min(wimulti2)) / (max(wimulti2) - min(wimulti2))
plot(mc0remtfmulti$year, mc0remtfmulti$yi, pch = 1, cex = sizemulti2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecmulti, predsmulti2$pred, lwd = 2, col = "darkblue")
lines(yearvecmulti, predsmulti2$ci.lb, lty = "dashed")
lines(yearvecmulti, predsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in single-center studies (using metafor)
mc0remtfsingle<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmasingle<-rma(yi, vi, data = mc0remtfsingle, method = "REML", mods = ~year)
yearvecsingle<-seq(min(data = dset[dset$center=="Single-center studies",]$year), max(data = dset[dset$center=="Single-center studies",]$year), 1)
predssingle2<-predict(mc0remtfmasingle, newmods = yearvecsingle)
wisingle2<-1/sqrt(mc0remtfsingle$vi+mc0remtfmasingle$tau2)
sizesingle2<- 1+2*(wisingle2 - min(wisingle2)) / (max(wisingle2) - min(wisingle2))
plot(mc0remtfsingle$year, mc0remtfsingle$yi, pch = 1, cex = sizesingle2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecsingle, predssingle2$pred, lwd = 2, col = "lightblue")
lines(yearvecsingle, predssingle2$ci.lb, lty = "dashed")
lines(yearvecsingle, predssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("72. MRA plot according to publication year in studies with low - moderate - serious risk of bias.png", width = W_robins, height = H_robins)
par(mfrow = c(3, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in ROBINS-I: "Low Risk of Bias" studies (using metafor)
mc0remtflow<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Low",], append = TRUE)
mc0remtfmalow<-rma(yi, vi, data = mc0remtflow, method = "REML", mods = ~year)
yearveclow<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), 1)
predslow2<-predict(mc0remtfmalow, newmods = yearveclow)
wilow2<-1/sqrt(mc0remtflow$vi+mc0remtfmalow$tau2)
sizelow2<- 1+2*(wilow2 - min(wilow2)) / (max(wilow2) - min(wilow2))
plot(mc0remtflow$year, mc0remtflow$yi, pch = 1, cex = sizelow2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Low", cex.main = 2.2, cex.lab = 1.4, xaxt = "n", yaxt = "n")
lines(yearveclow, predslow2$pred, lwd = 2, col = "purple")
lines(yearveclow, predslow2$ci.lb, lty = "dashed")
lines(yearveclow, predslow2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Moderate Risk of Bias" studies (using metafor)
mc0remtfmoderate<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Moderate",], append = TRUE)
mc0remtfmamoderate<-rma(yi, vi, data = mc0remtfmoderate, method = "REML", mods = ~year)
yearvecmoderate<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), 1)
predsmoderate2<-predict(mc0remtfmamoderate, newmods = yearvecmoderate)
wimoderate2<-1/sqrt(mc0remtfmoderate$vi+mc0remtfmamoderate$tau2)
sizemoderate2<- 1+2*(wimoderate2 - min(wimoderate2)) / (max(wimoderate2) - min(wimoderate2))
plot(mc0remtfmoderate$year, mc0remtfmoderate$yi, pch = 1, cex = sizemoderate2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Moderate", cex.main = 2.2, cex.lab = 1.4, xaxt = "n", yaxt = "n")
lines(yearvecmoderate, predsmoderate2$pred, lwd = 2, col = "magenta")
lines(yearvecmoderate, predsmoderate2$ci.lb, lty = "dashed")
lines(yearvecmoderate, predsmoderate2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Serious Risk of Bias" studies (using metafor)
mc0remtfserious<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Serious",], append = TRUE)
mc0remtfmaserious<-rma(yi, vi, data = mc0remtfserious, method = "REML", mods = ~year)
yearvecserious<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), 1)
predsserious2<-predict(mc0remtfmaserious, newmods = yearvecserious)
wiserious2<-1/sqrt(mc0remtfserious$vi+mc0remtfmaserious$tau2)
sizeserious2<- 1+2*(wiserious2 - min(wiserious2)) / (max(wiserious2) - min(wiserious2))
plot(mc0remtfserious$year, mc0remtfserious$yi, pch = 1, cex = sizeserious2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Serious", cex.main = 2.2, cex.lab = 1.4, xaxt = "n", yaxt = "n")
lines(yearvecserious, predsserious2$pred, lwd = 2, col = "pink")
lines(yearvecserious, predsserious2$ci.lb, lty = "dashed")
lines(yearvecserious, predsserious2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
dev.off()



png("73. MRA plot according to NOS quality stars (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in all studies (using metafor)
mc0remtfstars<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset, append = TRUE)
mc0remtfmastars<-rma(yi, vi, data = mc0remtfstars, method = "REML", mods = ~stars)
starsvec<-seq(min(dset$stars), max(dset$stars), 1)
predsstars2<-predict(mc0remtfmastars, newmods = starsvec)
wistars2<-1/sqrt(mc0remtfstars$vi+mc0remtfmastars$tau2)
sizestars2<-1+2*(wistars2 - min(wistars2)) / (max(wistars2) - min(wistars2))
plot(mc0remtfstars$stars, mc0remtfstars$yi, pch = 1, cex = sizestars2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvec, predsstars2$pred, lwd = 2, col = "red")
lines(starsvec, predsstars2$ci.lb, lty = "dashed")
lines(starsvec, predsstars2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("74. MRA plot according to NOS quality stars in studies with or without patient matching.png", W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies with patient matching (using metafor)
mc0remtfstarsmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmastarsmatched<-rma(yi, vi, data = mc0remtfstarsmatched, method = "REML", mods = ~stars)
starsvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$stars), max(dset[dset$matching=="Studies with patient matching",]$stars), 1)
predsstarsmatched2<-predict(mc0remtfmastarsmatched, newmods = starsvecmatched)
wistarsmatched2<-1/sqrt(mc0remtfstarsmatched$vi+mc0remtfmastarsmatched$tau2)
sizestarsmatched2<-1+2*(wistarsmatched2 - min(wistarsmatched2)) / (max(wistarsmatched2) - min(wistarsmatched2))
plot(mc0remtfstarsmatched$stars, mc0remtfstarsmatched$yi, pch = 1, cex = sizestarsmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecmatched, predsstarsmatched2$pred, lwd = 2, col = "darkgreen")
lines(starsvecmatched, predsstarsmatched2$ci.lb, lty = "dashed")
lines(starsvecmatched, predsstarsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies without patient matching (using metafor)
mc0remtfstarsnonmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmastarsnonmatched<-rma(yi, vi, data = mc0remtfstarsnonmatched, method = "REML", mods = ~stars)
starsvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$stars), max(dset[dset$matching=="Studies without patient matching",]$stars), 1)
predsstarsnonmatched2<-predict(mc0remtfmastarsnonmatched, newmods = starsvecnonmatched)
wistarsnonmatched2<-1/sqrt(mc0remtfstarsnonmatched$vi+mc0remtfmastarsnonmatched$tau2)
sizestarsnonmatched2<-1+2*(wistarsnonmatched2 - min(wistarsnonmatched2)) / (max(wistarsnonmatched2) - min(wistarsnonmatched2))
plot(mc0remtfstarsnonmatched$stars, mc0remtfstarsnonmatched$yi, pch = 1, cex = sizestarsnonmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecnonmatched, predsstarsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.lb, lty = "dashed")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("75. MRA plot according to NOS quality stars in single- or multicenter studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in multicenter studies (using metafor)
mc0remtfstarsmulti<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmastarsmulti<-rma(yi, vi, data = mc0remtfstarsmulti, method = "REML", mods = ~stars)
starsvecmulti<-seq(min(dset[dset$center=="Multicenter studies",]$stars), max(dset[dset$center=="Multicenter studies",]$stars), 1)
predsstarsmulti2<-predict(mc0remtfmastarsmulti, newmods = starsvecmulti)
wistarsmulti2<-1/sqrt(mc0remtfstarsmulti$vi+mc0remtfmastarsmulti$tau2)
sizestarsmulti2<-1+2*(wistarsmulti2 - min(wistarsmulti2)) / (max(wistarsmulti2) - min(wistarsmulti2))
plot(mc0remtfstarsmulti$stars, mc0remtfstarsmulti$yi, pch = 1, cex = sizestarsmulti2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecmulti, predsstarsmulti2$pred, lwd = 2, col = "darkblue")
lines(starsvecmulti, predsstarsmulti2$ci.lb, lty = "dashed")
lines(starsvecmulti, predsstarsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in single-center studies (using metafor)
mc0remtfstarssingle<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmastarssingle<-rma(yi, vi, data = mc0remtfstarssingle, method = "REML", mods = ~stars)
starsvecsingle<-seq(min(dset[dset$center=="Single-center studies",]$stars), max(dset[dset$center=="Single-center studies",]$stars), 1)
predsstarssingle2<-predict(mc0remtfmastarssingle, newmods = starsvecsingle)
wistarssingle2<-1/sqrt(mc0remtfstarssingle$vi+mc0remtfmastarssingle$tau2)
sizestarssingle2<-1+2*(wistarssingle2 - min(wistarssingle2)) / (max(wistarssingle2) - min(wistarssingle2))
plot(mc0remtfstarssingle$stars, mc0remtfstarssingle$yi, pch = 1, cex = sizestarssingle2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in eGFR change from baseline (RPN / RAPN vs. OPN) in ml/min/1.73m²", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecsingle, predsstarssingle2$pred, lwd = 2, col = "lightblue")
lines(starsvecsingle, predsstarssingle2$ci.lb, lty = "dashed")
lines(starsvecsingle, predsstarssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


#################################################### ΔCREATININE (REM) ##########################################################

#Now we define the dataset of interest
dset<-ΔCREATININE

# First we define the order of reporting the different subgroups
order_post2018 <- c("Studies published after 2018", "Studies published before 2018")
order_matching <- c("Studies with patient matching", "Studies without patient matching")
order_center <- c("Multicenter studies", "Single-center studies")
order_robins <- c("Studies with ROBINS-I: Low", "Studies with ROBINS-I: Moderate", "Studies with ROBINS-I: Serious")

# Then we apply the predefined order of reporting to the dataset
dset$post2018 <- factor(dset$post2018, levels = order_post2018)
dset$matching <- factor(dset$matching, levels = order_matching)
dset$center <- factor(dset$center, levels = order_center)
dset$robins <- factor(dset$robins, levels = order_robins)


# Pooled meta analysis
png("76. Forest plot (pooled).png", width = 800, height = 350)
mc0re<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, studlab = study, comb.fixed = FALSE, hakn = TRUE)
forestmc0re<-forest(mc0re, text.addline1 = "Mean Difference in creatinine change from baseline (mg/dl)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0re$lower,3))-0.1, max(round(mc0re$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
weights_mc <- mc0re$w.random
dev.off()

png("77. Funnel plot.png", width = W_fr, height = H_fr)
# We set the margins to add space
# mar = c(bottom, left, top, right)
# mgp1: distance between the axis title and labels, mgp2: distance between the axis ticks and labels
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0))  
funnelmc0re<-funnel(mc0re, pch = 20,cex = 1, contour = c(0.9,0.95,0.99), col.contour = c("darkgray", "gray", "lightgray"), xlim = c(-0.6,0.6), xlab = "", ylab = "", axes = FALSE)
# First we draw a rectangle by obtaining the coordinates of the plot
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
legend(min(round(mc0re$TE,3)), 0.8, c("0.1 > p > 0.05", "0.05 > p > 0.01", "p < 0.01"), fill = c("darkgray", "gray", "lightgray"), bty = "n", cex = 1.5)
title("Funnel plot with contours of statistical significance", cex.main = 2, xlab = "Mean Difference (MD)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()

png("78. Radial plot with Egger's test.png", width = W_fr, height = H_fr)
radialmc0re<-radial(mc0re)
eggersmc0re<-metabias(mc0re, method.bias = "linreg", plotit = TRUE)
eggersmc0re
regmc0re<-lm(I(mc0re$TE/mc0re$seTE) ~ I(1/mc0re$seTE))
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
radial(mc0re, cex = 1.5, cex.lab = 1.5, axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
abline(regmc0re)
title("Radial plot with a solid regression line for Egger's test", cex.main = 2)
dev.off()

# Small study Effects
png("79. Funnel plot with small study effects.png", width = W_fr, height = H_fr)
par(mar = c(6, 6, 5, 4), mgp = c(3.75, 1, 0)) 
l2<-limitmeta(mc0re)
funnel(l2, cex = 1.5, xlim = c(-0.5,0.5), xlab = "", ylab = "", axes = FALSE)
coords <- par("usr")
rect(coords[1], coords[3], coords[2], coords[4], border = "black", lwd = 1)
axis(2, cex.axis = 1.5, pos = coords[1])
axis(1, cex.axis = 1.5, pos = coords[3])
print(l2, digits = 3)
title("Funnel plot with a curved regression line for small study effects", cex.main = 2, xlab = "Mean Difference (MD)", ylab = "Standard Error (SE)", cex.lab = 1.5)
dev.off()


# subgroup analysis (post2018)
png("80. Forest plot with subgroups according to publication year.png", width = 800, height = 450)
mc0repost2018<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = post2018, print.byvar = FALSE)
forestmc0repost2018<-forest(mc0repost2018, text.addline1 = "Mean Difference in creatinine change from baseline (mg/dl)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0repost2018$lower,3))-0.1, max(round(mc0repost2018$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (matching)
png("81. Forest plot with subgroups according to patient matching.png", width = 800, height = 450)
mc0rematched<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = matching, print.byvar = FALSE)
forestmc0rematched<-forest(mc0rematched, text.addline1 = "Mean Difference in creatinine change from baseline (mg/dl)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0rematched$lower,3))-0.1, max(round(mc0rematched$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (center)
png("82. Forest plot with subgroups according to the number of centers.png", width = 800, height = 450)
mc0recenter<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = center, print.byvar = FALSE)
forestmc0recenter<-forest(mc0recenter, text.addline1 = "Mean Difference in creatinine change from baseline (mg/dl)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0recenter$lower,3))-0.1, max(round(mc0recenter$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()

# subgroup analysis (robins)
png("83. Forest plot with subgroups according to ROBINS-I.png", width = 800, height = 450)
mc0rerobins<-metacont(nexp,mexp,sexp,nctrl,mctrl,sctrl,sm="MD",data = dset, comb.fixed = FALSE, hakn = TRUE, studlab = study, byvar = robins, print.byvar = FALSE)
forestmc0rerobins<-forest(mc0rerobins, text.addline1 = "Mean Difference in creatinine change from baseline (mg/dl)", text.addline2 = "Comparison: RPN / RAPN vs. OPN", xlim = c(min(round(mc0rerobins$lower,3))-0.1, max(round(mc0rerobins$upper,3))+0.1), showweights = TRUE, digits = 3, digits.se = 3, fs.xlab = 1, label.e = "RPN / RAPN", label.c = "OPN", label.right = "Favours OPN", label.left = "Favours RPN / RAPN", just = "center")
dev.off()


# Meta Regression Analysis for publication year in all studies (using metafor)
png("84. MRA plot according to publication year (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
mc0remtf<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset, append = TRUE)
mc0remtfma<-rma(yi, vi, data = mc0remtf, method = "REML", mods = ~year)
yearvec<-seq(min(dset$year), max(dset$year), 1)
preds2<-predict(mc0remtfma, newmods = yearvec)
wi2<-1/sqrt(mc0remtf$vi+mc0remtfma$tau2)
size2<-1+2*(wi2 - min(wi2)) / (max(wi2) - min(wi2))
plot(mc0remtf$year, mc0remtf$yi, pch = 1, cex = size2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvec, preds2$pred, lwd = 2, col = "red")
lines(yearvec, preds2$ci.lb, lty = "dashed")
lines(yearvec, preds2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("85. MRA plot according to publication year in studies with or without patient matching.png", width = W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in studies with patient matching (using metafor)
mc0remtfmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmamatched<-rma(yi, vi, data = mc0remtfmatched, method = "REML", mods = ~year)
yearvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$year), max(dset[dset$matching=="Studies with patient matching",]$year), 1)
predsmatched2<-predict(mc0remtfmamatched, newmods = yearvecmatched)
wimatched2<-1/sqrt(mc0remtfmatched$vi+mc0remtfmamatched$tau2)
sizematched2<- 1+2*(wimatched2 - min(wimatched2)) / (max(wimatched2) - min(wimatched2))
plot(mc0remtfmatched$year, mc0remtfmatched$yi, pch = 1, cex = sizematched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecmatched, predsmatched2$pred, lwd = 2, col = "darkgreen")
lines(yearvecmatched, predsmatched2$ci.lb, lty = "dashed")
lines(yearvecmatched, predsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in studies without patient matching (using metafor)
mc0remtfnonmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmanonmatched<-rma(yi, vi, data = mc0remtfnonmatched, method = "REML", mods = ~year)
yearvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$year), max(dset[dset$matching=="Studies without patient matching",]$year), 1)
predsnonmatched2<-predict(mc0remtfmanonmatched, newmods = yearvecnonmatched)
winonmatched2<-1/sqrt(mc0remtfnonmatched$vi+mc0remtfmanonmatched$tau2)
sizenonmatched2<- 1+2*(winonmatched2 - min(winonmatched2)) / (max(winonmatched2) - min(winonmatched2))
plot(mc0remtfnonmatched$year, mc0remtfnonmatched$yi, pch = 1, cex = sizenonmatched2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecnonmatched, predsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(yearvecnonmatched, predsnonmatched2$ci.lb, lty = "dashed")
lines(yearvecnonmatched, predsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("86. MRA plot according to publication year in multi- or single-center studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in multicenter studies (using metafor)
mc0remtfmulti<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmamulti<-rma(yi, vi, data = mc0remtfmulti, method = "REML", mods = ~year)
yearvecmulti<-seq(min(data = dset[dset$center=="Multicenter studies",]$year), max(data = dset[dset$center=="Multicenter studies",]$year), 1)
predsmulti2<-predict(mc0remtfmamulti, newmods = yearvecmulti)
wimulti2<-1/sqrt(mc0remtfmulti$vi+mc0remtfmamulti$tau2)
sizemulti2<- 1+2*(wimulti2 - min(wimulti2)) / (max(wimulti2) - min(wimulti2))
plot(mc0remtfmulti$year, mc0remtfmulti$yi, pch = 1, cex = sizemulti2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecmulti, predsmulti2$pred, lwd = 2, col = "darkblue")
lines(yearvecmulti, predsmulti2$ci.lb, lty = "dashed")
lines(yearvecmulti, predsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for publication year in single-center studies (using metafor)
mc0remtfsingle<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmasingle<-rma(yi, vi, data = mc0remtfsingle, method = "REML", mods = ~year)
yearvecsingle<-seq(min(data = dset[dset$center=="Single-center studies",]$year), max(data = dset[dset$center=="Single-center studies",]$year), 1)
predssingle2<-predict(mc0remtfmasingle, newmods = yearvecsingle)
wisingle2<-1/sqrt(mc0remtfsingle$vi+mc0remtfmasingle$tau2)
sizesingle2<- 1+2*(wisingle2 - min(wisingle2)) / (max(wisingle2) - min(wisingle2))
plot(mc0remtfsingle$year, mc0remtfsingle$yi, pch = 1, cex = sizesingle2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(yearvecsingle, predssingle2$pred, lwd = 2, col = "lightblue")
lines(yearvecsingle, predssingle2$ci.lb, lty = "dashed")
lines(yearvecsingle, predssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("87. MRA plot according to publication year in studies with low - moderate - serious risk of bias.png", width = W_robins, height = H_robins)
par(mfrow = c(3, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for publication year in ROBINS-I: "Low Risk of Bias" studies (using metafor)
mc0remtflow<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Low",], append = TRUE)
mc0remtfmalow<-rma(yi, vi, data = mc0remtflow, method = "REML", mods = ~year)
yearveclow<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Low",]$year), 1)
predslow2<-predict(mc0remtfmalow, newmods = yearveclow)
wilow2<-1/sqrt(mc0remtflow$vi+mc0remtfmalow$tau2)
sizelow2<- 1+2*(wilow2 - min(wilow2)) / (max(wilow2) - min(wilow2))
plot(mc0remtflow$year, mc0remtflow$yi, pch = 1, cex = sizelow2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Low", cex.main = 2.2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearveclow, predslow2$pred, lwd = 2, col = "purple")
lines(yearveclow, predslow2$ci.lb, lty = "dashed")
lines(yearveclow, predslow2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Moderate Risk of Bias" studies (using metafor)
mc0remtfmoderate<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Moderate",], append = TRUE)
mc0remtfmamoderate<-rma(yi, vi, data = mc0remtfmoderate, method = "REML", mods = ~year)
yearvecmoderate<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Moderate",]$year), 1)
predsmoderate2<-predict(mc0remtfmamoderate, newmods = yearvecmoderate)
wimoderate2<-1/sqrt(mc0remtfmoderate$vi+mc0remtfmamoderate$tau2)
sizemoderate2<- 1+2*(wimoderate2 - min(wimoderate2)) / (max(wimoderate2) - min(wimoderate2))
plot(mc0remtfmoderate$year, mc0remtfmoderate$yi, pch = 1, cex = sizemoderate2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Moderate", cex.main = 2.2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecmoderate, predsmoderate2$pred, lwd = 2, col = "magenta")
lines(yearvecmoderate, predsmoderate2$ci.lb, lty = "dashed")
lines(yearvecmoderate, predsmoderate2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
# Meta Regression Analysis for publication year in ROBINS-I: "Serious Risk of Bias" studies (using metafor)
mc0remtfserious<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$robins=="Studies with ROBINS-I: Serious",], append = TRUE)
mc0remtfmaserious<-rma(yi, vi, data = mc0remtfserious, method = "REML", mods = ~year)
yearvecserious<-seq(min(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), max(data = dset[dset$robins=="Studies with ROBINS-I: Serious",]$year), 1)
predsserious2<-predict(mc0remtfmaserious, newmods = yearvecserious)
wiserious2<-1/sqrt(mc0remtfserious$vi+mc0remtfmaserious$tau2)
sizeserious2<- 1+2*(wiserious2 - min(wiserious2)) / (max(wiserious2) - min(wiserious2))
plot(mc0remtfserious$year, mc0remtfserious$yi, pch = 1, cex = sizeserious2, xlim = c(min(mc0remtf$year)-1, max(mc0remtf$year)+1), ylim = c(min(mc0remtf$yi)-1, max(mc0remtf$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "Year of publication", main = "Meta-regression of the comparative effect in studies with ROBINS-I: Serious", cex.main = 2.2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(yearvecserious, predsserious2$pred, lwd = 2, col = "pink")
lines(yearvecserious, predsserious2$ci.lb, lty = "dashed")
lines(yearvecserious, predsserious2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtf$yi)-1,0), round(max(mc0remtf$yi)+1,0), 1), cex.axis = 1.7)
axis(side = 1, cex.axis = 1.7)
dev.off()



png("88. MRA plot according to NOS quality stars (pooled).png", width = W_pool, height = H_pool)
par(mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in all studies (using metafor)
mc0remtfstars<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset, append = TRUE)
mc0remtfmastars<-rma(yi, vi, data = mc0remtfstars, method = "REML", mods = ~stars)
starsvec<-seq(min(dset$stars), max(dset$stars), 1)
predsstars2<-predict(mc0remtfmastars, newmods = starsvec)
wistars2<-1/sqrt(mc0remtfstars$vi+mc0remtfmastars$tau2)
sizestars2<-1+2*(wistars2 - min(wistars2)) / (max(wistars2) - min(wistars2))
plot(mc0remtfstars$stars, mc0remtfstars$yi, pch = 1, cex = sizestars2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in all studies", cex.main = 2, cex.lab = 1.5, xaxt = "n", yaxt = "n")
lines(starsvec, predsstars2$pred, lwd = 2, col = "red")
lines(starsvec, predsstars2$ci.lb, lty = "dashed")
lines(starsvec, predsstars2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("89. MRA plot according to NOS quality stars in studies with or without patient matching.png", W_match, height = H_match)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies with patient matching (using metafor)
mc0remtfstarsmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies with patient matching",], append = TRUE)
mc0remtfmastarsmatched<-rma(yi, vi, data = mc0remtfstarsmatched, method = "REML", mods = ~stars)
starsvecmatched<-seq(min(dset[dset$matching=="Studies with patient matching",]$stars), max(dset[dset$matching=="Studies with patient matching",]$stars), 1)
predsstarsmatched2<-predict(mc0remtfmastarsmatched, newmods = starsvecmatched)
wistarsmatched2<-1/sqrt(mc0remtfstarsmatched$vi+mc0remtfmastarsmatched$tau2)
sizestarsmatched2<-1+2*(wistarsmatched2 - min(wistarsmatched2)) / (max(wistarsmatched2) - min(wistarsmatched2))
plot(mc0remtfstarsmatched$stars, mc0remtfstarsmatched$yi, pch = 1, cex = sizestarsmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies with patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecmatched, predsstarsmatched2$pred, lwd = 2, col = "darkgreen")
lines(starsvecmatched, predsstarsmatched2$ci.lb, lty = "dashed")
lines(starsvecmatched, predsstarsmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in studies without patient matching (using metafor)
mc0remtfstarsnonmatched<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$matching=="Studies without patient matching",], append = TRUE)
mc0remtfmastarsnonmatched<-rma(yi, vi, data = mc0remtfstarsnonmatched, method = "REML", mods = ~stars)
starsvecnonmatched<-seq(min(dset[dset$matching=="Studies without patient matching",]$stars), max(dset[dset$matching=="Studies without patient matching",]$stars), 1)
predsstarsnonmatched2<-predict(mc0remtfmastarsnonmatched, newmods = starsvecnonmatched)
wistarsnonmatched2<-1/sqrt(mc0remtfstarsnonmatched$vi+mc0remtfmastarsnonmatched$tau2)
sizestarsnonmatched2<-1+2*(wistarsnonmatched2 - min(wistarsnonmatched2)) / (max(wistarsnonmatched2) - min(wistarsnonmatched2))
plot(mc0remtfstarsnonmatched$stars, mc0remtfstarsnonmatched$yi, pch = 1, cex = sizestarsnonmatched2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in studies without patient matching", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecnonmatched, predsstarsnonmatched2$pred, lwd = 2, col = "lightgreen")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.lb, lty = "dashed")
lines(starsvecnonmatched, predsstarsnonmatched2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()


png("90. MRA plot according to NOS quality stars in single- or multicenter studies.png", width = W_center, height = H_center)
par(mfrow = c(2, 1), mar = c(5, 5.5, 4, 2) + 0.1)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in multicenter studies (using metafor)
mc0remtfstarsmulti<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Multicenter studies",], append = TRUE)
mc0remtfmastarsmulti<-rma(yi, vi, data = mc0remtfstarsmulti, method = "REML", mods = ~stars)
starsvecmulti<-seq(min(dset[dset$center=="Multicenter studies",]$stars), max(dset[dset$center=="Multicenter studies",]$stars), 1)
predsstarsmulti2<-predict(mc0remtfmastarsmulti, newmods = starsvecmulti)
wistarsmulti2<-1/sqrt(mc0remtfstarsmulti$vi+mc0remtfmastarsmulti$tau2)
sizestarsmulti2<-1+2*(wistarsmulti2 - min(wistarsmulti2)) / (max(wistarsmulti2) - min(wistarsmulti2))
plot(mc0remtfstarsmulti$stars, mc0remtfstarsmulti$yi, pch = 1, cex = sizestarsmulti2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in multicenter studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecmulti, predsstarsmulti2$pred, lwd = 2, col = "darkblue")
lines(starsvecmulti, predsstarsmulti2$ci.lb, lty = "dashed")
lines(starsvecmulti, predsstarsmulti2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
# Meta Regression Analysis for Newcastle-Ottawa Scale (NOS) quality stars in single-center studies (using metafor)
mc0remtfstarssingle<-escalc(measure = "MD",n1i = nexp, m1i = mexp, sd1i = sexp, n2i = nctrl,m2i = mctrl, sd2i = sctrl, data = dset[dset$center=="Single-center studies",], append = TRUE)
mc0remtfmastarssingle<-rma(yi, vi, data = mc0remtfstarssingle, method = "REML", mods = ~stars)
starsvecsingle<-seq(min(dset[dset$center=="Single-center studies",]$stars), max(dset[dset$center=="Single-center studies",]$stars), 1)
predsstarssingle2<-predict(mc0remtfmastarssingle, newmods = starsvecsingle)
wistarssingle2<-1/sqrt(mc0remtfstarssingle$vi+mc0remtfmastarssingle$tau2)
sizestarssingle2<-1+2*(wistarssingle2 - min(wistarssingle2)) / (max(wistarssingle2) - min(wistarssingle2))
plot(mc0remtfstarssingle$stars, mc0remtfstarssingle$yi, pch = 1, cex = sizestarssingle2, xlim = c(min(mc0remtfstars$stars)-1, max(mc0remtfstars$stars)+1), ylim = c(min(mc0remtfstars$yi)-1, max(mc0remtfstars$yi)+1), ylab = "Mean Difference in creatinine change from baseline (RPN / RAPN vs. OPN) in mg/dl", xlab = "NOS quality stars", main = "Meta-regression of the comparative effect in single-center studies", cex.main = 2, cex.lab = 1.2, xaxt = "n", yaxt = "n")
lines(starsvecsingle, predsstarssingle2$pred, lwd = 2, col = "lightblue")
lines(starsvecsingle, predsstarssingle2$ci.lb, lty = "dashed")
lines(starsvecsingle, predsstarssingle2$ci.ub, lty = "dashed")
abline(h=0, lwd = 2, lty = "dotted")
axis(side = 2, at = seq(round(min(mc0remtfstars$yi)-1,0), round(max(mc0remtfstars$yi)+1,0), 1), cex.axis = 1.5)
axis(side = 1, cex.axis = 1.5)
dev.off()
